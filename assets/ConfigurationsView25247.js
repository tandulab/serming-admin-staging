import{u as Ve}from"./location25247.js";import{u as Z,e as P,s as M}from"./helpers25247.js";import{x as ee,z as te,B as ge,y as pe,A as ve,o as H,l as C,a as W,u as Te,c as j,i as R,_ as J,r as m,q as $,b as U,m as Y,w as b,g as l,f as s,e as I,t as L,p as X,h as O,s as F,v as ae,F as K,E as ie,d as Ee,G as xe}from"../index25247.js";import{c as le,a as ce,d as Pe}from"./index.esm25247.js";import{F as re}from"./vee-validate.esm25247.js";import{I as ne}from"./InputTextWithValidation25247.js";import{u as ye}from"./category25247.js";import{u as be}from"./configuration25247.js";import{d as ke,e as ue,D as Be,a as oe,b as se,g as we}from"./formatData25247.js";import"./attraction25247.js";import"./_commonjsHelpers25247.js";/* empty css                                                                            */class me{static async fetchAll(e){return(await ee(`/admin/locations/${e}/courses`)).data}static async addCourse(e){return(await te(`/admin/locations/${e.location_id}/courses`,e)).data.course}static async updateCourse(e){return(await ge(`/admin/locations/${e.location_id}/courses/${e.course.id}`,e)).data.course}static async deleteCourse(e){return await pe(`/admin/courses/${e}`)}}const Ce=ve({id:"course",state:()=>({course:{},courses:[],response_courses:{}}),getters:{allCourses:t=>t.courses,responseCourses:t=>t.response_courses,getTotalCourses:t=>t.response_courses?t.response_courses.total:0,getCurrentCourse:t=>t.course},actions:{async fetchAllCourses(t){await me.fetchAll(t).then(e=>{this.response_courses=e,this.courses=e.courses})},async addCourse(t){await me.addCourse(t).then(e=>{this.course=e})},async updateCourse(t){await me.updateCourse(t).then(e=>{this.course=e})},async deleteCourse(t){await me.deleteCourse(t).then()}}});class _e{static async fetchAll(e){return(await ee(`/admin/courses/${e}/tickets`)).data}static async addTicket(e){return await te(`/admin/courses/${e.course_id}/tickets`,e)}static async updateTicket(e){return await ge(`/admin/courses/${e.course_id}/tickets/${e.ticket.id}`,e)}static async deleteTicket(e){return await pe(`/admin/courses/${e.course_id}/tickets/${e.ticket_id}`)}}const Ue=ve({id:"ticket",state:()=>({ticket:{},tickets:[],response_tickets:{}}),getters:{allTickets:t=>t.tickets,responseTickets:t=>t.response_tickets,getTotalTickets:t=>t.response_tickets?t.response_tickets.total:0,getCurrentTicket:t=>t.ticket},actions:{async fetchAllTickets(t){await _e.fetchAll(t).then(e=>{this.response_tickets=e,this.tickets=e.tickets})},async addTicket(t){await _e.addTicket(t).then()},async updateTicket(t){await _e.updateTicket(t).then()},async deleteTicket(t){await _e.deleteTicket(t).then()}}}),je={props:["course","location_id"],setup(t,e){H(()=>{t.course&&t.course.id?(n.value=Object.assign({},t.course),E()):n.value.translations={it:{name:{id:null,text:""},description:{id:null,text:""}},en:{name:{id:null,text:""},description:{id:null,text:""}}},n.value.tickets=[]});const n=C({}),o=C([]),y=C("it"),w=le({name:ce().required("Nome percorso obbligatorio")}),{showLoader:d,hideLoader:c}=Z(),u=W(),k=Ce(),f=ye(),g=Ue(),p=Te(),a=C(!1),v=j(()=>k.allCourses),D=j(()=>f.allCategories),r=j(()=>g.responseTickets),i=j(()=>k.getCurrentCourse),h=j(()=>p.languages),S=function(A){d(),k.addCourse(A).then(()=>{c(),M(u,{message:"Percorso aggiunto correttamente",error:!1}),e.emit("onSubmit")}).catch(T=>{c(),P(u,T)})},E=async function(){let A=t.course.id?t.course.id:i.value.id;d(),await g.fetchAllTickets(A).then(()=>{c()}).catch(T=>{c(),P(u,T)})},z=function(A){d(),k.updateCourse(A).then(()=>{c(),M(u,{message:"Percorso modificato correttamente",error:!1}),e.emit("onSubmit")}).catch(T=>{c(),P(u,T)})},B=function(){const A=Object.assign({},n.value);let T={it:{name:A.translations.it.name.text,description:A.translations.it.description.text},en:{name:A.translations.en.name.text,description:A.translations.en.description.text}};A.translations=T,A.name=A.translations.it.name,A.description=A.translations.it.description;const G={course:A,location_id:t.location_id};n.value.id?z(G):S(G)},N=function(){let T={translations:{en:{name:{text:"",id:null},description:{text:"",id:null}},it:{name:{text:"",id:null},description:{text:"",id:null}}},price:0};n.value.tickets.push(T),o.value.push(T)},_=function(A,T){A.id?x(A):n.value.tickets.splice(T,1)},x=async function(A){const T={course_id:t.course.id?t.course.id:i.value.id,ticket_id:A.id};d(),await g.deleteTicket(T).then(()=>{c(),M(u,{message:"Biglietto eliminato correttamente",error:!1}),E()}).catch(G=>{c(),P(u,G)})},V=function(A){let{newData:T,index:G}=A;n.value.tickets[G]=T;let Ae={it:{name:T.translations.it.name.text,description:T.translations.it.description.text},en:{name:T.translations.en.name.text,description:T.translations.en.description.text}};T.translations=Ae,T.name=T.translations.it.name,T.description=T.translations.it.description,T.id?de(T):q(T)},q=async function(A){const T={course_id:t.course.id?t.course.id:i.value.id,ticket:A};await g.addTicket(T).then(()=>{c(),M(u,{message:"Biglietto aggiunto correttamente",error:!1}),E()}).catch(G=>{c(),P(u,G)})},de=async function(A){const T={course_id:t.course.id?t.course.id:i.value.id,ticket:A};await g.updateTicket(T).then(()=>{c(),M(u,{message:"Biglietto aggiornato correttamente",error:!1}),E()}).catch(G=>{c(),P(u,G)})},Se=function(A){let T={it:{name:A.translations.it.name.text,description:A.translations.it.description.text},en:{name:A.translations.en.name.text,description:A.translations.en.description.text}};A.translations=T,A.id?de(A):q(A)};return R(D,()=>{n.value.category||(n.value.category=D.value[0])}),R(r,()=>{r.value&&r.value.tickets.length>0?n.value.tickets=Object.assign([],r.value.tickets):n.value.tickets=[]}),R(i,()=>{n.value=Object.assign({},i.value)}),{form:n,schema:w,loading:a,editingRows:o,response_tickets:r,lang_selected:y,onSubmit:B,addTicket:N,onDeleteTicket:_,onRowEditSave:V,updateTicketsApi:de,onPublicTicket:Se,courses:v,categories:D,languages:h}},components:{Form:re,InputTextWithValidation:ne}},Ie={class:"col-12 flex justify-content-end m-0 p-0 align-items-center"},ze={key:0,class:"formgrid grid mt-3"},Me={class:"field col-12"},Le={class:"field col-12"},Re={for:"description"},Ne={key:1,class:"flex justify-content-end mt-4 mb-3"},Oe={key:0},Fe={key:0},qe={class:"w-full"},He={class:"flex justify-content-center"},We={class:"flex align-items-center justify-content-end mt-6"};function Ge(t,e,n,o,y,w){const d=m("Dropdown"),c=m("InputTextWithValidation"),u=m("Textarea"),k=m("Button"),f=m("InputText"),g=m("Column"),p=m("InputSwitch"),a=m("DataTable"),v=m("Form"),D=$("tooltip");return U(),Y(v,{onSubmit:o.onSubmit,"validation-schema":o.schema},{default:b(()=>[l("div",Ie,[s(d,{options:o.languages,optionLabel:"name",optionValue:"value",class:"m-2 capitalize dropdown-lng",modelValue:o.lang_selected,"onUpdate:modelValue":e[0]||(e[0]=r=>o.lang_selected=r)},null,8,["options","modelValue"])]),o.lang_selected&&o.form&&o.form.translations?(U(),I("div",ze,[l("div",Me,[s(c,{name:"name",label:"Nome percorso* ("+o.lang_selected.toUpperCase()+")",modelValue:o.form.translations[o.lang_selected].name.text,"onUpdate:modelValue":e[1]||(e[1]=r=>o.form.translations[o.lang_selected].name.text=r)},null,8,["label","modelValue"])]),l("div",Le,[l("label",Re,"Descrizione ("+L(o.lang_selected.toUpperCase())+")",1),s(u,{rows:"5",cols:"30",name:"description",id:"description",label:"Nome percorso*",modelValue:o.form.translations[o.lang_selected].description.text,"onUpdate:modelValue":e[2]||(e[2]=r=>o.form.translations[o.lang_selected].description.text=r),class:"w-full"},null,8,["modelValue"])])])):X("",!0),o.form.id?(U(),I("div",Ne,[s(k,{label:"Tipologia biglietto",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[3]||(e[3]=r=>o.addTicket())})])):X("",!0),o.form.id&&o.lang_selected?(U(),Y(a,{key:2,value:o.form.tickets,ref:"dt",loading:o.loading,stripedRows:"",editingRows:o.editingRows,"onUpdate:editingRows":e[4]||(e[4]=r=>o.editingRows=r),editMode:"row",dataKey:"id",onRowEditSave:o.onRowEditSave},{empty:b(()=>[O(" Nessun biglietto trovato. ")]),default:b(()=>[s(g,{header:"Tipo biglietto",style:{"min-width":"150px"},field:"name"},{body:b(({data:r})=>{var i;return[r.translations[o.lang_selected].name?(U(),I("span",Oe,L((i=r.translations[o.lang_selected].name)==null?void 0:i.text),1)):X("",!0)]}),editor:b(({data:r,field:i})=>[s(f,{modelValue:r.translations[o.lang_selected][i].text,"onUpdate:modelValue":h=>r.translations[o.lang_selected][i].text=h,name:"ticket_name_"+o.lang_selected,id:"ticket_name_"+o.lang_selected,type:"text"},null,8,["modelValue","onUpdate:modelValue","name","id"])]),_:1}),s(g,{header:"Descrizione",field:"description"},{body:b(({data:r})=>{var i;return[r.translations[o.lang_selected].description?(U(),I("span",Fe,L((i=r.translations[o.lang_selected].description)==null?void 0:i.text),1)):X("",!0)]}),editor:b(({data:r,field:i})=>[l("div",qe,[s(u,{modelValue:r.translations[o.lang_selected][i].text,"onUpdate:modelValue":h=>r.translations[o.lang_selected][i].text=h,class:"w-full",name:"desc_"+o.lang_selected},null,8,["modelValue","onUpdate:modelValue","name"])])]),_:1}),s(g,{header:"Prezzo",field:"price",bodyStyle:"min-width: 6rem"},{body:b(({data:r})=>[O(" € "+L((+r.price).toFixed(2)),1)]),editor:b(({data:r,field:i})=>[s(f,{modelValue:r[i],"onUpdate:modelValue":h=>r[i]=h},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),s(g,{header:"Stato",field:"public",bodyStyle:"min-width: 6rem"},{body:b(({data:r,field:i})=>[s(p,{modelValue:r[i],"onUpdate:modelValue":h=>r[i]=h,onChange:h=>o.onPublicTicket(r)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),editor:b(({data:r,field:i})=>[s(p,{modelValue:r[i],"onUpdate:modelValue":h=>r[i]=h},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),s(g,{rowEditor:!0,bodyStyle:"text-align:center; padding-right:0;min-width: 6rem"}),s(g,{header:"",style:{width:"3rem","padding-left":"0"}},{body:b(({data:r,index:i})=>[l("div",He,[F(s(k,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:h=>o.onDeleteTicket(r,i)},null,8,["onClick"]),[[D,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading","editingRows","onRowEditSave"])):X("",!0),l("div",We,[s(k,{label:"Annulla",text:"",onClick:e[5]||(e[5]=r=>t.$emit("onClose"))}),s(k,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit","validation-schema"])}const Ke=J(je,[["render",Ge]]),Je={props:["location_id"],setup(t){H(()=>{w.value=!0,d.value={first:0,rows:n.value.rows,sortField:null,sortOrder:null},d.value.page=0,v()});const e=W(),n=C(),o=C(),y=C(),w=C(!0),d=C(),c=C(0),u=C(!1),{showLoader:k,hideLoader:f}=Z(),g=Ce(),p=j(()=>g.responseCourses),a=ae();j(()=>a.submitDialog);function v(){k(),setTimeout(()=>{D()},Math.random()*1e3+250)}const D=async function(){w.value=!0,await g.fetchAllCourses(t.location_id).then(()=>{w.value=!1,f()}).catch(z=>{w.value=!1,f(),P(e,z)})},r=function(z){y.value=z,u.value=!0},i=function(z){y.value=z;let B="Sei sicuro di voler archiviare questo percorso?";a.setDialog("Archivia percorso","Archivia","Annulla",B),a.setBtnSubmit(!1),a.setDynamicDialogVisibility(!0)},h=function(z){const B=Object.assign({},z);let N={it:{name:B.translations.it.name.text,description:B.translations.it.description.text},en:{name:B.translations.en.name.text,description:B.translations.en.description.text}};B.translations=N;const _={course:B,location_id:t.location_id};g.updateCourse(_).then(()=>{f(),M(e,{message:"Percorso modificato correttamente",error:!1}),D()}).catch(x=>{f(),P(e,x)})},S=function(){return y.value&&y.value.id?"Modifica percorso":"Aggiungi percorso"},E=function(){D(),u.value=!1};return R(t,()=>{t.location_id&&D()}),{dt:n,responseCourses:p,loading:w,totalRecords:c,lazyParams:d,op:o,visible:u,currentCourse:y,loadLazyData:v,onEditCourse:r,closeDialog:E,getHeader:S,updateCourse:h,onArchiveCourse:i}},components:{CourseDialog:Ke}},Qe={class:"flex justify-content-end mt-4 mb-3"},Xe={class:"flex justify-content-center"};function Ye(t,e,n,o,y,w){const d=m("Button"),c=m("Column"),u=m("InputSwitch"),k=m("DataTable"),f=m("CourseDialog"),g=m("Dialog"),p=$("tooltip");return U(),I(K,null,[l("div",Qe,[s(d,{label:"Percorso",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[0]||(e[0]=a=>o.onEditCourse({}))})]),s(k,{value:o.responseCourses.courses,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:""},{empty:b(()=>[O(" Nessun percorso trovato. ")]),default:b(()=>[s(c,{header:"Nome"},{body:b(({data:a})=>{var v;return[O(L((v=a.translations.it.name)==null?void 0:v.text),1)]}),_:1}),s(c,{header:"Tipologie biglietti"},{body:b(({data:a})=>[(U(!0),I(K,null,ie(a.tickets,v=>{var D;return U(),I("div",{key:v.id},L((D=v.translations.it.name)==null?void 0:D.text),1)}),128))]),_:1}),s(c,{header:"Prezzo"},{body:b(({data:a})=>[(U(!0),I(K,null,ie(a.tickets,v=>(U(),I("div",{key:v.id}," € "+L((+v.price).toFixed(2)),1))),128))]),_:1}),s(c,{header:"Stato"},{body:b(({data:a})=>[s(u,{modelValue:a.public,"onUpdate:modelValue":v=>a.public=v,onChange:v=>o.updateCourse(a)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),s(c,{header:""},{body:b(({data:a})=>[l("div",Xe,[F(s(d,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:v=>o.onEditCourse(a),class:"mr-2"},null,8,["onClick"]),[[p,"Modifica",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"]),s(g,{visible:o.visible,"onUpdate:visible":e[3]||(e[3]=a=>o.visible=a),modal:"",header:o.getHeader(),style:{width:"70rem"},onHide:e[4]||(e[4]=a=>o.closeDialog())},{default:b(()=>[s(f,{course:o.currentCourse,location_id:n.location_id,onOnSubmit:e[1]||(e[1]=a=>o.closeDialog()),onOnClose:e[2]||(e[2]=a=>o.closeDialog())},null,8,["course","location_id"])]),_:1},8,["visible","header"])],64)}const Ze=J(Je,[["render",Ye]]),$e={props:["config","location_id","course_id","duplicate"],setup(t,e){H(()=>{t.config&&t.config.id?(n.value=Object.assign({},t.config),n.value.from_date&&(n.value.from_date=ke(n.value.from_date)),n.value.to_date&&(n.value.to_date=ke(n.value.to_date)),t.duplicate&&delete n.value.id):(n.value.location_id=t.location_id,n.value.course_id=t.course_id,n.value.booking_rule_slots=[]),N()});const n=C({}),o=C([]),y=C(!1),w=le({name_config:ce().required("Nome configurazione obbligatoria")}),{showLoader:d,hideLoader:c}=Z(),u=W(),k=ye(),f=C(!1),g=be(),p=j(()=>k.allCategories),a=j(()=>g.responseTickets),v=j(()=>g.responseCourses),D=function(){d();const _=Object.assign({},n.value);_.from_date&&(_.from_date=ue(_.from_date)),_.to_date&&(_.to_date=ue(_.to_date)),_.booking_rule_slots=[],n.value.booking_rule_slots&&n.value.booking_rule_slots.forEach(V=>{V.available_seats!=""&&V.start_at!=""&&_.booking_rule_slots.push(V)});const x={booking_rule:_};g.addConfiguration(x).then(()=>{c(),M(u,{message:"Configurazione aggiunta correttamente",error:!1}),e.emit("onSubmit",n.value.course_id)}).catch(V=>{c(),P(u,V)})},r=function(){d();const _=Object.assign({},n.value);_.from_date&&(_.from_date=ue(_.from_date)),_.to_date&&(_.to_date=ue(_.to_date)),_.booking_rule_slots=[],n.value.booking_rule_slots&&n.value.booking_rule_slots.forEach(V=>{V.available_seats!=""&&V.start_at!=""&&_.booking_rule_slots.push(V)});const x={booking_rule:_};g.updateConfiguration(x).then(()=>{c(),M(u,{message:"Configurazione modificata correttamente",error:!1}),e.emit("onSubmit",n.value.course_id)}).catch(V=>{c(),P(u,V)})},i=function(){n.value.id?r():D()},h=function(){let _={};_.price=0,n.value.tickets.unshift(_),o.value.push(n.value.tickets[0])},S=function(_){let{newData:x,index:V}=_;n.value.booking_rule_slots[V]=x},E=function(){let _={start_at:"",available_seats:"",id:"-1"};n.value.booking_rule_slots.push(_),o.value.push(_)},z=function(_,x){n.value.booking_rule_slots.splice(x,1)},B=function(_){_?n.value.wdays=[0,1,2,3,4,5,6]:n.value.wdays=[]},N=function(){const _=new Map;_.set("location_id",n.value.location_id),_.set("course_id",n.value.course_id),g.getAllTickets(_).catch(x=>{P(u,x)})};return R(p,()=>{n.value.category||(n.value.category=p.value[0])}),{form:n,schema:w,loading:f,editingRows:o,check_all:y,onSubmit:i,addTicket:h,onRowEditSave:S,checkAll:B,deleteSlot:z,addSlot:E,fetchAllTickets:N,categories:p,responseCourses:v,responseTickets:a}},components:{Form:re,InputTextWithValidation:ne}};const eo={class:"formgrid grid mt-3"},oo={class:"field col-12"},to={class:"field flex flex-column col-6"},no=l("label",{for:"location"},"Percorso",-1),io={class:"field col-3"},so=l("label",{from:"date_from"},"Dal",-1),ao={class:"field col-3"},lo=l("label",{from:"date_to"},"Al",-1),co={class:"field col-12 mt-3"},ro=l("label",null,"Giorni",-1),uo={class:"card flex flex-wrap gap-3 mt-2"},mo={class:"flex align-items-center mr-4"},_o=l("label",{for:"all",class:"ml-2"}," Tutti i giorni ",-1),fo={class:"flex align-items-center"},go=l("label",{for:"lun",class:"ml-2"}," Lun ",-1),po={class:"flex align-items-center"},vo=l("label",{for:"mar",class:"ml-2"}," Mar ",-1),bo={class:"flex align-items-center"},ho=l("label",{for:"mer",class:"ml-2"}," Mer ",-1),ko={class:"flex align-items-center"},yo=l("label",{for:"gio",class:"ml-2"}," Gio ",-1),Co={class:"flex align-items-center"},xo=l("label",{for:"ven",class:"ml-2"}," Ven ",-1),wo={class:"flex align-items-center"},Vo=l("label",{for:"sab",class:"ml-2"}," Sab ",-1),Do={class:"flex align-items-center"},So=l("label",{for:"dom",class:"ml-2"}," Dom ",-1),Ao={class:"field col-3 mt-3"},To=l("label",null,"Biglietti",-1),Eo={for:"ticket.id",class:"ml-2 flex align-items-center"},Po={class:"inline-block",style:{"min-width":"150px"}},Bo={class:"text-right"},Uo=l("div",{class:"col-9"},null,-1),jo={class:"col-8 mt-3"},Io={class:"field flex justify-content-between align-items-end mt-4 mb-3"},zo=l("label",null,"Orari",-1),Mo={class:"flex justify-content-center"},Lo={class:"flex align-items-center justify-content-end mt-6"};function Ro(t,e,n,o,y,w){const d=m("InputTextWithValidation"),c=m("Dropdown"),u=m("Calendar"),k=m("Checkbox"),f=m("Button"),g=m("InputMask"),p=m("Column"),a=m("InputNumber"),v=m("DataTable"),D=m("Form"),r=$("tooltip");return U(),Y(D,{onSubmit:o.onSubmit,"validation-schema":o.schema},{default:b(()=>[l("div",eo,[l("div",oo,[s(d,{name:"name_config",label:"Nome configurazione*",modelValue:o.form.name,"onUpdate:modelValue":e[0]||(e[0]=i=>o.form.name=i),id:"name_config",type:"text"},null,8,["modelValue"])]),l("div",to,[no,s(c,{modelValue:o.form.course_id,"onUpdate:modelValue":e[1]||(e[1]=i=>o.form.course_id=i),options:o.responseCourses.courses,optionLabel:"name",optionValue:"id",placeholder:"",name:"location",onChange:e[2]||(e[2]=i=>{o.form.booking_rule_ticket_ids=[],o.fetchAllTickets()})},null,8,["modelValue","options"])]),l("div",io,[so,s(u,{inputId:"date_from",modelValue:o.form.from_date,"onUpdate:modelValue":e[3]||(e[3]=i=>o.form.from_date=i),dateFormat:"dd/mm",placeholder:"dd/mm",panelClass:"hide-year"},null,8,["modelValue"])]),l("div",ao,[lo,s(u,{inputId:"date_to",modelValue:o.form.to_date,"onUpdate:modelValue":e[4]||(e[4]=i=>o.form.to_date=i),dateFormat:"dd/mm",placeholder:"dd/mm",panelClass:"hide-year"},null,8,["modelValue"])]),l("div",co,[ro,l("div",uo,[l("div",mo,[s(k,{modelValue:o.check_all,"onUpdate:modelValue":[e[5]||(e[5]=i=>o.check_all=i),e[6]||(e[6]=i=>o.checkAll(i))],inputId:"all",name:"week",binary:!0},null,8,["modelValue"]),_o]),l("div",fo,[s(k,{modelValue:o.form.wdays,"onUpdate:modelValue":e[7]||(e[7]=i=>o.form.wdays=i),inputId:"lun",name:"week",value:1},null,8,["modelValue"]),go]),l("div",po,[s(k,{modelValue:o.form.wdays,"onUpdate:modelValue":e[8]||(e[8]=i=>o.form.wdays=i),inputId:"mar",name:"week",value:2},null,8,["modelValue"]),vo]),l("div",bo,[s(k,{modelValue:o.form.wdays,"onUpdate:modelValue":e[9]||(e[9]=i=>o.form.wdays=i),inputId:"mer",name:"week",value:3},null,8,["modelValue"]),ho]),l("div",ko,[s(k,{modelValue:o.form.wdays,"onUpdate:modelValue":e[10]||(e[10]=i=>o.form.wdays=i),inputId:"gio",name:"week",value:4},null,8,["modelValue"]),yo]),l("div",Co,[s(k,{modelValue:o.form.wdays,"onUpdate:modelValue":e[11]||(e[11]=i=>o.form.wdays=i),inputId:"ven",name:"week",value:5},null,8,["modelValue"]),xo]),l("div",wo,[s(k,{modelValue:o.form.wdays,"onUpdate:modelValue":e[12]||(e[12]=i=>o.form.wdays=i),inputId:"sab",name:"week",value:6},null,8,["modelValue"]),Vo]),l("div",Do,[s(k,{modelValue:o.form.wdays,"onUpdate:modelValue":e[13]||(e[13]=i=>o.form.wdays=i),inputId:"dom",name:"week",value:0},null,8,["modelValue"]),So])])]),l("div",Ao,[To,(U(!0),I(K,null,ie(o.responseTickets.tickets,i=>{var h;return U(),I("div",{key:i.id,class:"flex align-items-center mb-2 mt-2"},[s(k,{modelValue:o.form.booking_rule_ticket_ids,"onUpdate:modelValue":e[14]||(e[14]=S=>o.form.booking_rule_ticket_ids=S),inputId:i.id+"",value:i.id},null,8,["modelValue","inputId","value"]),l("label",Eo,[l("div",Po,L((h=i.translations)==null?void 0:h.it.name.text),1),l("div",Bo,"€ "+L(i.price),1)])])}),128))]),Uo,l("div",jo,[l("div",Io,[zo,s(f,{label:"Slot orario",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[15]||(e[15]=i=>o.addSlot())})]),s(v,{value:o.form.booking_rule_slots,stripedRows:"",editingRows:o.editingRows,"onUpdate:editingRows":e[16]||(e[16]=i=>o.editingRows=i),editMode:"row",dataKey:"id",onRowEditSave:o.onRowEditSave},{empty:b(()=>[O(" Nessuno slot orario trovato. ")]),default:b(()=>[s(p,{header:"Ora",field:"start_at"},{editor:b(({data:i,field:h})=>[s(g,{id:"basic",modelValue:i[h],"onUpdate:modelValue":S=>i[h]=S,mask:"99:99"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),s(p,{header:"Posti",field:"available_seats"},{editor:b(({data:i,field:h})=>[s(a,{modelValue:i[h],"onUpdate:modelValue":S=>i[h]=S,min:0},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),s(p,{rowEditor:!0,style:{width:"8rem"},bodyStyle:"text-align:right"}),s(p,{header:"",style:{width:"3rem","padding-left":"0"}},{body:b(({data:i,index:h})=>[l("div",Mo,[F(s(f,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:S=>o.deleteSlot(i,h)},null,8,["onClick"]),[[r,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","editingRows","onRowEditSave"])])]),l("div",Lo,[s(f,{label:"Annulla",text:"",onClick:e[17]||(e[17]=i=>t.$emit("onClose"))}),s(f,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit","validation-schema"])}const No=J($e,[["render",Ro]]),Oo={props:["location_id"],setup(t){H(()=>{d.value=!0,c.value={first:0,rows:n.value.rows,sortField:null,sortOrder:null},c.value.page=0,t.location_id&&i(t.location_id)});const e=W(),n=C(),o=C(),y=C(),w=C(),d=C(!0),c=C(),u=C(0),k=C(!1),f=C(),g=C(!1),p=be(),a=j(()=>p.responseConfigurations),v=ae(),D=j(()=>v.submitDialog),r=j(()=>p.responseCourses),i=async function(x){const V=new Map;V.set("location_id",x),await p.getAllCourses(V).then(()=>{d.value=!1}).catch(q=>{d.value=!1,P(e,q)})},h=async function(x){if(!x)return;d.value=!0;const V=new Map;V.set("location_id",t.location_id),V.set("course_id",x),await p.fetchAllConfigurations(V).then(()=>{d.value=!1}).catch(q=>{d.value=!1,P(e,q)})},S=function(x){y.value=x;let V="Sei sicuro di voler eliminare questa configurazione?";v.setDialog("Elimina configurazione","Elimina","Annulla",V),v.setBtnSubmit(!1),v.setDynamicDialogVisibility(!0)},E=async function(){y.value&&await p.deleteConfiguration(y.value).then(()=>{d.value=!1,M(e,{message:"Configurazione eliminata correttamente",error:!1}),h(f.value)}).catch(x=>{d.value=!1,P(e,x)})},z=function(x,V){w.value=x,k.value=!0,g.value=V},B=function(x){return x.map(q=>Be.local(2022,1,2+q).setLocale("it").toFormat("ccc")).join(", ")},N=function(x){f.value=x,h(f.value),k.value=!1},_=function(){return g.value?"Duplica configurazione":w.value&&w.value.id&&!g.value?"Modifica configurazione":"Nuova configurazione"};return R(D,x=>{D.value&&E()}),R(r,()=>{r.value.courses&&r.value.courses[0]&&(f.value=r.value.courses[0].id,h(f.value))}),R(t,()=>{t.location_id&&i(t.location_id)}),{dt:n,responseConfigurations:a,loading:d,totalRecords:u,lazyParams:c,op:o,visible:k,currentConfiguration:w,responseCourses:r,course_id:f,flag_duplicate:g,fromMMDDtoDDMM:ke,onDeleteConfiguration:E,confirmDelete:S,onEditConfiguration:z,fetchAllConfigurations:h,convertWdays:B,closeDialog:N,getHeader:_}},components:{ConfigurationDialog:No}},Fo={class:"flex justify-content-between mt-4 mb-3"},qo={class:"field flex flex-column"},Ho=l("label",{for:"location"},"Percorso",-1),Wo={class:"capitalize"},Go={class:"flex justify-content-center"};function Ko(t,e,n,o,y,w){const d=m("Dropdown"),c=m("Button"),u=m("Column"),k=m("DataTable"),f=m("ConfigurationDialog"),g=m("Dialog"),p=$("tooltip");return U(),I(K,null,[l("div",Fo,[l("div",qo,[Ho,s(d,{modelValue:o.course_id,"onUpdate:modelValue":e[0]||(e[0]=a=>o.course_id=a),options:o.responseCourses.courses,optionLabel:"translations.it.name.text",optionValue:"id",placeholder:"",name:"location",onChange:e[1]||(e[1]=a=>o.fetchAllConfigurations(o.course_id))},null,8,["modelValue","options"])]),s(c,{label:"Configurazione",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[2]||(e[2]=a=>o.onEditConfiguration({},!1))})]),s(k,{value:o.responseConfigurations.booking_rules,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:""},{empty:b(()=>[O(" Nessuna configurazione trovata. ")]),default:b(()=>[s(u,{header:"Nome",field:"name"}),s(u,{header:"Dal Al"},{body:b(({data:a})=>[O(L(o.fromMMDDtoDDMM(a.from_date))+" - "+L(o.fromMMDDtoDDMM(a.to_date)),1)]),_:1}),s(u,{header:"Valida il",field:"week"},{body:b(({data:a})=>[l("div",Wo,L(o.convertWdays(a.wdays)),1)]),_:1}),s(u,{header:""},{body:b(({data:a})=>[l("div",Go,[F(s(c,{link:"",icon:"pi pi-copy",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:v=>o.onEditConfiguration(a,!0)},null,8,["onClick"]),[[p,"Duplica",void 0,{top:!0}]]),F(s(c,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:v=>o.onEditConfiguration(a,!1)},null,8,["onClick"]),[[p,"Modifica",void 0,{top:!0}]]),F(s(c,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:v=>o.confirmDelete(a.id)},null,8,["onClick"]),[[p,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"]),s(g,{visible:o.visible,"onUpdate:visible":e[5]||(e[5]=a=>o.visible=a),modal:"",header:o.getHeader(),style:{width:"70rem"}},{default:b(()=>[s(f,{config:o.currentConfiguration,onOnSubmit:e[3]||(e[3]=a=>o.closeDialog(a)),onOnClose:e[4]||(e[4]=a=>o.visible=!1),location_id:n.location_id,course_id:o.course_id,duplicate:o.flag_duplicate},null,8,["config","location_id","course_id","duplicate"])]),_:1},8,["visible","header"])],64)}const Jo=J(Oo,[["render",Ko]]);class Q{static async fetchAll(e){return e?(await ee("/admin/booking_exception_rules",e)).data:{}}static async getCourses(e){return(await ee("/admin/booking_exception_rules/courses",e)).data}static async getTickets(e){return(await ee("/admin/booking_exception_rules/tickets",e)).data}static async addBookingException(e){return await te("/admin/booking_exception_rules",e)}static async updateBookingException(e){return await ge(`/admin/booking_exception_rules/${e.booking_exception_rule.id}`,e)}static async deleteBookingException(e){return e==null?{}:await pe(`/admin/booking_exception_rules/${e}`)}static async fetchAllClosings(e){return e?(await ee(`/admin/booking_exception_rules/closings?location_id=${e.get("location_id")}`)).data:{}}static async createClosing(e){return await te("/admin/booking_exception_rules/closings",e)}static async deleteClosing(e){return await te("/admin/booking_exception_rules/delete_closings",e)}}const he=ve({id:"booking_exception",state:()=>({booking_exception:{},booking_exceptions:[],response_booking_exceptions:{},response_courses:{},response_tickets:{},response_closings:{}}),getters:{allBookingExceptions:t=>t.booking_exceptions,responseBookingExceptions:t=>t.response_booking_exceptions,getTotalBookingExceptions:t=>t.response_booking_exceptions?t.response_booking_exceptions.total:0,getCurrentBookingException:t=>t.booking_exception,responseCourses:t=>t.response_courses,responseTickets:t=>t.response_tickets,responseClosings:t=>t.response_closings},actions:{async fetchAllBookingExceptions(t){await Q.fetchAll(t).then(e=>{this.response_booking_exceptions=e,this.booking_exceptions=e.booking_exceptions})},async fetchAllClosings(t){await Q.fetchAllClosings(t).then(e=>{this.response_closings=e})},async getAllCourses(t){await Q.getCourses(t).then(e=>{this.response_courses=e})},async getAllTickets(t){await Q.getTickets(t).then(e=>{this.response_tickets=e})},async addBookingException(t){await Q.addBookingException(t).then()},async updateBookingException(t){await Q.updateBookingException(t).then()},async deleteBookingException(t){t!=null&&await Q.deleteBookingException(t).then()},async addClosing(t){await Q.createClosing(t).then()},async deleteClosing(t){await Q.deleteClosing(t).then()}}}),Qo={props:["config","location_id","course_id","duplicate"],setup(t,e){H(()=>{t.config&&t.config.id?(n.value=Object.assign({},t.config),n.value.date&&(n.value.date=oe(n.value.date)),t.duplicate&&delete n.value.id):(n.value.location_id=t.location_id,n.value.course_id=t.course_id,n.value.booking_exception_rule_slots=[]),B()});const n=C({}),o=C([]),y=le({name:ce().required("Nome eccezione obbligatoria")}),{showLoader:w,hideLoader:d}=Z(),c=W(),u=ye(),k=C(!1),f=be(),g=he(),p=j(()=>u.allCategories),a=j(()=>f.responseTickets),v=j(()=>f.responseCourses),D=function(){w();const _=Object.assign({},n.value);_.date&&(_.date=se(_.date)),_.booking_exception_rule_slots=[],n.value.booking_exception_rule_slots&&n.value.booking_exception_rule_slots.forEach(V=>{V.available_seats!=""&&V.start_at!=""&&_.booking_exception_rule_slots.push(V)});const x={booking_exception_rule:_};g.addBookingException(x).then(()=>{d(),M(c,{message:"Eccezione aggiunta correttamente",error:!1}),e.emit("onSubmit",n.value.course_id)}).catch(V=>{d(),P(c,V)})},r=function(){w();const _=Object.assign({},n.value);_.date&&(_.date=se(_.date)),_.booking_exception_rule_slots=[],n.value.booking_exception_rule_slots&&n.value.booking_exception_rule_slots.forEach(V=>{V.available_seats!=""&&V.start_at!=""&&_.booking_exception_rule_slots.push(V)});const x={booking_exception_rule:_};g.updateBookingException(x).then(()=>{d(),M(c,{message:"Eccezione modificata correttamente",error:!1}),e.emit("onSubmit",n.value.course_id)}).catch(V=>{d(),P(c,V)})},i=function(){n.value.id?r():D()},h=function(){let _={};_.price=0,n.value.tickets.unshift(_),o.value.push(n.value.tickets[0])},S=function(_){let{newData:x,index:V}=_;n.value.booking_exception_rule_slots[V]=x},E=function(){let _={start_at:"",available_seats:"",id:"-1"};n.value.booking_exception_rule_slots.push(_),o.value.push(_)},z=function(_,x){n.value.booking_exception_rule_slots.splice(x,1)},B=function(){const _=new Map;_.set("location_id",n.value.location_id),_.set("course_id",n.value.course_id),f.getAllTickets(_).catch(x=>{P(c,x)})},N=function(){e.emit("onSubmit",n.value)};return R(p,()=>{n.value.category||(n.value.category=p.value[0])}),{form:n,schema:y,loading:k,editingRows:o,onSubmit:i,addTicket:h,onRowEditSave:S,deleteSlot:z,addSlot:E,fetchAllTickets:B,resetForm:N,categories:p,responseTickets:a,responseCourses:v}},components:{Form:re,InputTextWithValidation:ne}},Xo={class:"formgrid grid mt-3"},Yo={class:"field col-12"},Zo={class:"field flex flex-column col-6"},$o=l("label",{for:"location"},"Percorso",-1),et={class:"field col-3"},ot=l("label",{from:"date"},"Il",-1),tt=l("div",{class:"field col-3"},null,-1),nt={class:"field col-3 mt-3"},it=l("label",null,"Biglietti",-1),st=["for"],at={class:"inline-block",style:{"min-width":"150px"}},lt={class:"text-right"},ct=l("div",{class:"col-9"},null,-1),rt={class:"field col-8 mt-3"},dt={class:"field flex justify-content-between align-items-end mt-4 mb-3"},ut=l("label",null,"Orari",-1),mt={class:"flex justify-content-center"},_t={class:"flex align-items-center justify-content-end mt-6"};function ft(t,e,n,o,y,w){const d=m("InputTextWithValidation"),c=m("Dropdown"),u=m("Calendar"),k=m("Checkbox"),f=m("Button"),g=m("InputMask"),p=m("Column"),a=m("InputNumber"),v=m("DataTable"),D=m("Form"),r=$("tooltip");return U(),Y(D,{onSubmit:o.onSubmit,"validation-schema":o.schema},{default:b(()=>[l("div",Xo,[l("div",Yo,[s(d,{name:"name",label:"Nome eccezione*",modelValue:o.form.name,"onUpdate:modelValue":e[0]||(e[0]=i=>o.form.name=i)},null,8,["modelValue"])]),l("div",Zo,[$o,s(c,{modelValue:o.form.course_id,"onUpdate:modelValue":e[1]||(e[1]=i=>o.form.course_id=i),options:o.responseCourses.courses,optionLabel:"name",optionValue:"id",placeholder:"",name:"location",onChange:e[2]||(e[2]=i=>o.fetchAllTickets())},null,8,["modelValue","options"])]),l("div",et,[ot,s(u,{inputId:"date",modelValue:o.form.date,"onUpdate:modelValue":e[3]||(e[3]=i=>o.form.date=i),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])]),tt,l("div",nt,[it,(U(!0),I(K,null,ie(o.responseTickets.tickets,i=>{var h;return U(),I("div",{key:i.id,class:"flex align-items-center mb-2"},[s(k,{modelValue:o.form.booking_exception_rule_ticket_ids,"onUpdate:modelValue":e[4]||(e[4]=S=>o.form.booking_exception_rule_ticket_ids=S),inputId:i.id+"",name:"category",value:i.id},null,8,["modelValue","inputId","value"]),l("label",{for:i.id+"",class:"ml-2 flex align-items-center"},[l("div",at,L((h=i.translations)==null?void 0:h.it.name.text),1),l("div",lt,"€ "+L(i.price),1)],8,st)])}),128))]),ct,l("div",rt,[l("div",dt,[ut,s(f,{label:"Slot orario",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[5]||(e[5]=i=>o.addSlot())})]),s(v,{value:o.form.booking_exception_rule_slots,ref:"dt",loading:o.loading,stripedRows:"",editingRows:o.editingRows,"onUpdate:editingRows":e[6]||(e[6]=i=>o.editingRows=i),editMode:"row",dataKey:"id",onRowEditSave:o.onRowEditSave},{empty:b(()=>[O(" Nessuno slot orario trovato. ")]),default:b(()=>[s(p,{header:"Ora",field:"start_at"},{editor:b(({data:i,field:h})=>[s(g,{id:"basic",modelValue:i[h],"onUpdate:modelValue":S=>i[h]=S,mask:"99:99"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),s(p,{header:"Posti",field:"available_seats"},{editor:b(({data:i,field:h})=>[s(a,{modelValue:i[h],"onUpdate:modelValue":S=>i[h]=S,min:0},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),s(p,{rowEditor:!0,style:{width:"8rem"},bodyStyle:"text-align:right"}),s(p,{header:"",style:{width:"3rem","padding-left":"0"}},{body:b(({data:i,index:h})=>[l("div",mt,[F(s(f,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:S=>o.deleteSlot(i,h)},null,8,["onClick"]),[[r,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading","editingRows","onRowEditSave"])])]),l("div",_t,[s(f,{label:"Annulla",text:"",onClick:e[7]||(e[7]=i=>o.resetForm())}),s(f,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit","validation-schema"])}const gt=J(Qo,[["render",ft]]),pt={props:["location_id"],setup(t){H(()=>{d.value=!0,c.value={first:0,rows:n.value.rows,sortField:null,sortOrder:null},c.value.page=0,t.location_id&&h(t.location_id)});const e=W(),n=C(),o=C(),y=C(),w=C(),d=C(!0),c=C(),u=C(0),k=C(!1);C([]);const f=C(),g=C(!1),p=be(),a=he(),v=j(()=>a.responseBookingExceptions),D=ae(),r=j(()=>D.submitDialog),i=j(()=>p.responseCourses),h=async function(x){const V=new Map;V.set("location_id",x),await p.getAllCourses(V).then(()=>{d.value=!1}).catch(q=>{d.value=!1,P(e,q)})},S=async function(x){if(!x)return;d.value=!0;const V=new Map;V.set("location_id",t.location_id),V.set("course_id",x),await a.fetchAllBookingExceptions(V).then(()=>{d.value=!1}).catch(q=>{d.value=!1,P(e,q)})},E=function(x){y.value=x;let V="Sei sicuro di voler eliminare questa eccezione?";D.setDialog("Elimina eccezione","Elimina","Annulla",V),D.setBtnSubmit(!1),D.setDynamicDialogVisibility(!0)},z=async function(){y.value&&await a.deleteBookingException(y.value).then(()=>{d.value=!1,M(e,{message:"Eccezione eliminata correttamente",error:!1}),S(f.value)}).catch(x=>{d.value=!1,P(e,x)})},B=function(x,V){w.value=x,k.value=!0,g.value=V},N=function(x){f.value=x,S(x),k.value=!1},_=function(){return g.value?"Duplica eccezione":w.value&&w.value.id&&!g.value?"Modifica eccezione":"Nuova eccezione"};return R(r,x=>{x&&z()}),R(i,()=>{i.value&&i.value.courses&&i.value.courses.length>0&&(f.value=i.value.courses[0].id,S(f.value))}),R(t,()=>{t.location_id&&h(t.location_id)}),{dt:n,responseBookingExceptions:v,loading:d,totalRecords:u,lazyParams:c,op:o,visible:k,currentConfiguration:w,responseCourses:i,course_id:f,flag_duplicate:g,onDeleteConfigurationException:z,confirmDelete:E,onEditConfiguration:B,getHeader:_,closeDialog:N,fetchAllBookingExceptions:S,formatPrettyDate:oe}},components:{BookingExceptionDialog:gt}},vt={class:"flex justify-content-between mt-4 mb-3"},bt={class:"field flex flex-column"},ht=l("label",{for:"location"},"Percorso",-1),kt={class:"flex justify-content-center"};function yt(t,e,n,o,y,w){const d=m("Dropdown"),c=m("Button"),u=m("Column"),k=m("DataTable"),f=m("BookingExceptionDialog"),g=m("Dialog"),p=$("tooltip");return U(),I(K,null,[l("div",vt,[l("div",bt,[ht,s(d,{modelValue:o.course_id,"onUpdate:modelValue":e[0]||(e[0]=a=>o.course_id=a),options:o.responseCourses.courses,optionLabel:"name",optionValue:"id",placeholder:"",name:"location",onChange:e[1]||(e[1]=a=>o.fetchAllBookingExceptions(o.course_id))},null,8,["modelValue","options"])]),s(c,{label:"Eccezione",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[2]||(e[2]=a=>o.onEditConfiguration({},!1))})]),s(k,{value:o.responseBookingExceptions.booking_exception_rules,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:""},{empty:b(()=>[O(" Nessuna eccezione trovata. ")]),default:b(()=>[s(u,{header:"Nome",field:"name"}),s(u,{header:"Il"},{body:b(({data:a})=>[O(L(o.formatPrettyDate(a.date)),1)]),_:1}),s(u,{header:""},{body:b(({data:a})=>[l("div",kt,[F(s(c,{link:"",icon:"pi pi-copy",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:v=>o.onEditConfiguration(a,!0)},null,8,["onClick"]),[[p,"Duplica",void 0,{top:!0}]]),F(s(c,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:v=>o.onEditConfiguration(a,!1)},null,8,["onClick"]),[[p,"Modifica",void 0,{top:!0}]]),F(s(c,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:v=>o.confirmDelete(a.id)},null,8,["onClick"]),[[p,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"]),s(g,{visible:o.visible,"onUpdate:visible":e[4]||(e[4]=a=>o.visible=a),modal:"",header:o.getHeader(),style:{width:"70rem"}},{default:b(()=>[s(f,{config:o.currentConfiguration,onOnSubmit:e[3]||(e[3]=a=>o.closeDialog(a)),location_id:n.location_id,course_id:o.course_id,duplicate:o.flag_duplicate},null,8,["config","location_id","course_id","duplicate"])]),_:1},8,["visible","header"])],64)}const Ct=J(pt,[["render",yt]]),xt={props:["location_id","closing"],setup(t,e){H(()=>{t.closing&&t.closing.id?(n.value=Object.assign({},t.closing),n.value.date&&(n.value.date=oe(n.value.date))):n.value.location_id=t.location_id});const n=C({}),o=le({name:ce().required("Nome chiusura obbligatoria")}),{showLoader:y,hideLoader:w}=Z(),d=W(),c=Ve(),u=he(),k=j(()=>c.allLocations),f=function(v){y(),u.addClosing(v).then(()=>{w(),M(d,{message:"Chiusura aggiunta correttamente",error:!1}),e.emit("onSubmit")}).catch(D=>{w(),P(d,D)})},g=function(v){y(),u.updateBookingException(v).then(()=>{w(),M(d,{message:"Chiusura modificata correttamente",error:!1}),e.emit("onSubmit")}).catch(D=>{w(),P(d,D)})};return{form:n,schema:o,onSubmit:function(){const v=Object.assign({},n.value);v.date&&(v.date=se(v.date),v.location_id=t.location_id);const D={booking_exception_rule:v};n.value.id?g(D):f(D)},resetForm:function(){e.emit("onSubmit",n.value)},locations:k}},components:{Form:re,InputTextWithValidation:ne}},wt={class:"formgrid grid mt-3"},Vt={class:"field col-6"},Dt={class:"field col-6 flex flex-column"},St=l("label",{from:"from_date"},"Il",-1),At={class:"flex align-items-center justify-content-end mt-6"};function Tt(t,e,n,o,y,w){const d=m("InputTextWithValidation"),c=m("Calendar"),u=m("Button"),k=m("Form");return U(),Y(k,{onSubmit:o.onSubmit,"validation-schema":o.schema},{default:b(()=>[l("div",wt,[l("div",Vt,[s(d,{name:"name",label:"Nome chiusura*",modelValue:o.form.name,"onUpdate:modelValue":e[0]||(e[0]=f=>o.form.name=f)},null,8,["modelValue"])]),l("div",Dt,[St,s(c,{inputId:"date",modelValue:o.form.date,"onUpdate:modelValue":e[1]||(e[1]=f=>o.form.date=f),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])])]),l("div",At,[s(u,{label:"Annulla",text:"",onClick:e[2]||(e[2]=f=>o.resetForm())}),s(u,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit","validation-schema"])}const Et=J(xt,[["render",Tt]]),Pt={props:["location_id"],setup(t){H(()=>{d.value=!0,c.value={first:0,rows:n.value.rows,sortField:null,sortOrder:null},c.value.page=0,t.location_id&&a()});const e=W(),n=C(),o=C(),y=C(),w=C(),d=C(!0),c=C(),u=C(!1),k=he(),f=ae(),g=j(()=>f.submitDialog),p=j(()=>k.responseClosings),a=async function(){const S=new Map;S.set("location_id",t.location_id),await k.fetchAllClosings(S).then(()=>{d.value=!1}).catch(E=>{d.value=!1,P(e,E)})},v=function(S){y.value=S;let E="Sei sicuro di voler eliminare questa chiusura?";f.setDialog("Elimina chiusura","Elimina","Annulla",E),f.setBtnSubmit(!1),f.setDynamicDialogVisibility(!0)},D=async function(){if(!y.value)return;const S={location_id:t.location_id,date:y.value};await k.deleteClosing(S).then(()=>{d.value=!1,M(e,{message:"Chiusura eliminata correttamente",error:!1}),a()}).catch(E=>{d.value=!1,P(e,E)})},r=function(S){w.value=S,u.value=!0},i=function(){a(),u.value=!1},h=function(){return w.value&&w.value.id?"Modifica chiusura":"Nuova chiusura"};return R(g,S=>{g.value&&D()}),R(t,()=>{t.location_id&&a()}),{dt:n,responseClosings:p,loading:d,lazyParams:c,op:o,visible:u,currentClosing:w,formatPrettyDate:oe,onDeleteClosing:D,confirmDelete:v,onEditConfiguration:r,closeDialog:i,getHeader:h}},components:{ClosingDialog:Et}},Bt={class:"flex justify-content-end mt-4 mb-3"},Ut={class:"flex justify-content-center"};function jt(t,e,n,o,y,w){const d=m("Button"),c=m("Column"),u=m("DataTable"),k=m("ClosingDialog"),f=m("Dialog"),g=$("tooltip");return U(),I(K,null,[l("div",Bt,[s(d,{label:"Chiusura",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[0]||(e[0]=p=>o.onEditConfiguration({}))})]),s(u,{value:o.responseClosings.closings,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:""},{empty:b(()=>[O(" Nessuna chiusura trovata. ")]),default:b(()=>[s(c,{header:"Nome",field:"name"}),s(c,{header:"Il"},{body:b(({data:p})=>[O(L(o.formatPrettyDate(p.date)),1)]),_:1}),s(c,{header:""},{body:b(({data:p})=>[l("div",Ut,[F(s(d,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:a=>o.onEditConfiguration(p)},null,8,["onClick"]),[[g,"Modifica",void 0,{top:!0}]]),F(s(d,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:a=>o.confirmDelete(p.date)},null,8,["onClick"]),[[g,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"]),s(f,{visible:o.visible,"onUpdate:visible":e[3]||(e[3]=p=>o.visible=p),modal:"",header:o.getHeader(),style:{width:"70rem"}},{default:b(()=>[s(k,{onOnSubmit:e[1]||(e[1]=p=>o.closeDialog()),onOnClose:e[2]||(e[2]=p=>o.visible=!1),location_id:n.location_id,closing:o.currentClosing},null,8,["location_id","closing"])]),_:1},8,["visible","header"])],64)}const It=J(Pt,[["render",jt]]);class fe{static async fetchAll(e){return(await ee(`/admin/locations/${e}/access_points`)).data}static async addAccessPoint(e){return(await te(`/admin/locations/${e.location_id}/access_points`,e)).data.access_point}static async updateAccessPoint(e){return(await ge(`/admin/locations/${e.location_id}/access_points/${e.access_point.id}`,e)).data.access_point}static async deleteAccessPoint(e){return await pe(`/admin/locations/${e.location_id}/access_points/${e.access_point_id}`)}}const De=ve({id:"accessPoint",state:()=>({accessPoint:{},accessPoints:[],response_access_points:{}}),getters:{allAccessPoints:t=>t.accessPoints,responseAccessPoints:t=>t.response_access_points,getTotalAccessPoints:t=>t.response_access_points?t.response_access_points.total:0,getCurrentAccessPoint:t=>t.accessPoint},actions:{async fetchAllAccessPoints(t){await fe.fetchAll(t).then(e=>{this.response_access_points=e,this.accessPoints=e.access_points})},async addAccessPoint(t){await fe.addAccessPoint(t).then(e=>{this.accessPoint=e})},async updateAccessPoint(t){await fe.updateAccessPoint(t).then(e=>{this.accessPoint=e})},async deleteAccessPoint(t){await fe.deleteAccessPoint(t).then()}}}),zt={class:"formgrid grid mt-3"},Mt={class:"field col-12"},Lt={class:"field col-12"},Rt=l("label",{for:"description"},"Percorsi*",-1),Nt=l("br",null,null,-1),Ot={class:"field col-3 mt-3"},Ft={class:"flex align-items-center justify-content-end mt-6"},qt=Ee({__name:"AccessPointDialog",props:{access_point:{},location_id:{}},emits:["onSubmit","onClose"],setup(t,{emit:e}){const n=t,o=e,y=C({}),w=le({name:ce().required("Nome punto di accesso obbligatorio"),max_capacity:Pe().required("Capacità massima obbligatoria")}),{showLoader:d,hideLoader:c}=Z(),u=W(),k=De(),f=Ce(),g=j(()=>f.allCourses),p=function(){if(n.access_point&&n.access_point.id){const r=Object.assign({},n.access_point);r.courses&&Array.isArray(r.courses)?r.course_ids=r.courses.map(i=>i.id):r.course_ids=[],y.value=r}else y.value={name:"",course_ids:[],max_capacity:0,active:!0}},a=function(r){d(),k.addAccessPoint(r).then(()=>{c(),M(u,{message:"Punto di accesso aggiunto correttamente",error:!1}),o("onSubmit")}).catch(i=>{c(),P(u,i)})},v=function(r){d(),k.updateAccessPoint(r).then(()=>{c(),M(u,{message:"Punto di accesso modificato correttamente",error:!1}),o("onSubmit")}).catch(i=>{c(),P(u,i)})},D=function(){const i={access_point:Object.assign({},y.value),location_id:n.location_id};y.value.id?v(i):a(i)};return H(()=>{p()}),R(()=>n.access_point,()=>{p()}),(r,i)=>{const h=m("MultiSelect"),S=m("Button");return U(),Y(xe(re),{onSubmit:D,"validation-schema":xe(w)},{default:b(()=>[l("div",zt,[l("div",Mt,[s(ne,{name:"name",label:"Nome punto di accesso*",modelValue:y.value.name,"onUpdate:modelValue":i[0]||(i[0]=E=>y.value.name=E)},null,8,["modelValue"])]),l("div",Lt,[Rt,Nt,s(h,{modelValue:y.value.course_ids,"onUpdate:modelValue":i[1]||(i[1]=E=>y.value.course_ids=E),options:g.value,optionLabel:"name",optionValue:"id",placeholder:"Seleziona percorsi",maxSelectedLabels:3,class:"w-full"},null,8,["modelValue","options"])]),l("div",Ot,[s(ne,{name:"max_capacity",type:"number",label:"Capacità massima*",modelValue:String(y.value.max_capacity||""),"onUpdate:modelValue":i[2]||(i[2]=E=>y.value.max_capacity=Number(E))},null,8,["modelValue"])])]),l("div",Ft,[s(S,{label:"Annulla",text:"",onClick:i[3]||(i[3]=E=>r.$emit("onClose"))}),s(S,{label:"Conferma",type:"submit"})])]),_:1},8,["validation-schema"])}}}),Ht={props:["location_id"],setup(t){H(()=>{w.value=!0,d.value={first:0,rows:n.value.rows,sortField:null,sortOrder:null},d.value.page=0,D()});const e=W(),n=C(),o=C(),y=C(),w=C(!0),d=C(),c=C(0),u=C(!1),{showLoader:k,hideLoader:f}=Z(),g=De(),p=j(()=>g.responseAccessPoints),a=ae(),v=j(()=>a.submitDialog);function D(){k(),setTimeout(()=>{r()},Math.random()*1e3+250)}const r=async function(){w.value=!0,await g.fetchAllAccessPoints(t.location_id).then(()=>{w.value=!1,f()}).catch(B=>{w.value=!1,f(),P(e,B)})},i=function(B){y.value=B,u.value=!0},h=function(B){y.value=B;let N="Sei sicuro di voler eliminare questo punto di accesso?";a.setDialog("Elimina punto di accesso","Elimina","Annulla",N),a.setBtnSubmit(!1),a.setDynamicDialogVisibility(!0)},S=function(B){const _={access_point:Object.assign({},B),location_id:t.location_id};g.updateAccessPoint(_).then(()=>{f(),M(e,{message:"Punto di accesso modificato correttamente",error:!1}),r()}).catch(x=>{f(),P(e,x)})},E=function(){return y.value&&y.value.id?"Modifica punto di accesso":"Aggiungi punto di accesso"},z=function(){r(),u.value=!1};return R(t,()=>{t.location_id&&r()}),R(v,B=>{if(B){const N={access_point_id:y.value.id,location_id:t.location_id};g.deleteAccessPoint(N).then(()=>{M(e,{message:"Punto di accesso eliminato correttamente",error:!1}),r()}).catch(_=>{P(e,_)})}}),{dt:n,responseAccessPoints:p,loading:w,totalRecords:c,lazyParams:d,op:o,visible:u,currentAccessPoint:y,loadLazyData:D,onEditAccessPoint:i,closeDialog:z,getHeader:E,updateAccessPoint:S,onDeleteAccessPoint:h}},components:{AccessPointDialog:qt}},Wt={class:"flex justify-content-end mt-4 mb-3"},Gt={key:0},Kt={class:"flex justify-content-center"};function Jt(t,e,n,o,y,w){const d=m("Button"),c=m("Column"),u=m("InputSwitch"),k=m("DataTable"),f=m("AccessPointDialog"),g=m("Dialog"),p=$("tooltip");return U(),I(K,null,[l("div",Wt,[s(d,{label:"Punto di accesso",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[0]||(e[0]=a=>o.onEditAccessPoint({}))})]),s(k,{value:o.responseAccessPoints.access_points,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:""},{empty:b(()=>[O(" Nessun punto di accesso trovato. ")]),default:b(()=>[s(c,{header:"Nome"},{body:b(({data:a})=>[O(L(a.name),1)]),_:1}),s(c,{header:"Percorsi"},{body:b(({data:a})=>[a.courses&&a.courses.length>0?(U(),I("div",Gt,[(U(!0),I(K,null,ie(a.courses,v=>(U(),I("div",{key:v.id,class:"mb-1"},L(v.name),1))),128))])):X("",!0)]),_:1}),s(c,{header:"Capacità max.",field:"max_capacity"}),s(c,{header:"Stato"},{body:b(({data:a})=>[s(u,{modelValue:a.active,"onUpdate:modelValue":v=>a.active=v,onChange:v=>o.updateAccessPoint(a)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),s(c,{header:""},{body:b(({data:a})=>[l("div",Kt,[F(s(d,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:v=>o.onEditAccessPoint(a),class:"mr-2"},null,8,["onClick"]),[[p,"Modifica",void 0,{top:!0}]]),F(s(d,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:v=>o.onDeleteAccessPoint(a)},null,8,["onClick"]),[[p,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"]),s(g,{visible:o.visible,"onUpdate:visible":e[3]||(e[3]=a=>o.visible=a),modal:"",header:o.getHeader(),style:{width:"70rem"},onHide:e[4]||(e[4]=a=>o.closeDialog())},{default:b(()=>[s(f,{access_point:o.currentAccessPoint,location_id:n.location_id,onOnSubmit:e[1]||(e[1]=a=>o.closeDialog()),onOnClose:e[2]||(e[2]=a=>o.closeDialog())},null,8,["access_point","location_id"])]),_:1},8,["visible","header"])],64)}const Qt=J(Ht,[["render",Jt]]),Xt={setup(){H(()=>{g()});const t=C({}),e=Ve(),n=C(),o=C(),y=C(),{showLoader:w,hideLoader:d}=Z(),c=W(),u=C(!1),k=j(()=>e.allLocations),f=j(()=>e.getCurrentLocation),g=async function(){await e.fetchAllLocations().then(()=>{f.value&&(t.value.location=f.value,a())})},p=function(){e.updateCurrenLocation(t.value.location),a()},a=function(){o.value=oe(t.value.location.calendar_visible_from),y.value=oe(t.value.location.calendar_visible_to)},v=async function(){w();let D={calendar_visible_from:se(o.value),calendar_visible_to:se(y.value),location_id:t.value.location.id};await e.updateLocation(D).then(()=>{d(),M(c,{message:"Data aggiornata correttamente",error:!1}),o.value=we(o.value),y.value=we(y.value),u.value=!1}).catch(r=>{d(),P(c,r)})};return R(k,()=>{t.value.location_id=k.value[0].id}),{form:t,courseTable:n,calendar_visible_from:o,calendar_visible_to:y,active:u,locations:k,onChangeLocation:p,updateVisibility:v,formatPrettyDate:oe}},components:{CourseTable:Ze,OpeningsTable:Jo,BookingExceptionTable:Ct,ClosingsTable:It,AccessPointsTable:Qt}};const Yt=l("h1",null,"Configurazioni",-1),Zt={class:"flex align-items-center justify-content-between"},$t={class:"field col-3 flex flex-column"},en=l("label",{for:"location"},"Location",-1),on={class:"col-9 flex justify-content-end"},tn={class:"col-12 field"},nn=l("label",{class:"ml-1"},"Finestra di visibilità",-1),sn={class:"flex align-items-center mt-2 ml-0 pl-0 gap-5"};function an(t,e,n,o,y,w){var i;const d=m("Dropdown"),c=m("Calendar"),u=m("Inplace"),k=m("Card"),f=m("CourseTable"),g=m("TabPanel"),p=m("OpeningsTable"),a=m("BookingExceptionTable"),v=m("ClosingsTable"),D=m("AccessPointsTable"),r=m("TabView");return U(),I("div",null,[Yt,l("div",Zt,[l("div",$t,[en,s(d,{modelValue:o.form.location,"onUpdate:modelValue":e[0]||(e[0]=h=>o.form.location=h),options:o.locations,optionLabel:"name",placeholder:"",name:"location",onChange:e[1]||(e[1]=h=>o.onChangeLocation())},null,8,["modelValue","options"])]),l("div",on,[o.form.location?(U(),Y(k,{key:0,style:{width:"30rem"}},{content:b(()=>[l("div",tn,[nn,l("div",sn,[s(u,{closable:!0,onClose:e[3]||(e[3]=h=>o.updateVisibility()),active:o.active},{display:b(()=>[O(" Dal: "+L(o.calendar_visible_from),1)]),content:b(()=>[s(c,{inputId:"date",modelValue:o.calendar_visible_from,"onUpdate:modelValue":e[2]||(e[2]=h=>o.calendar_visible_from=h),dateFormat:"dd/mm/yy",manualInput:!0,autofocus:""},null,8,["modelValue"])]),_:1},8,["active"]),s(u,{closable:!0,onClose:e[5]||(e[5]=h=>o.updateVisibility()),active:o.active},{display:b(()=>[O(" Al: "+L(o.calendar_visible_to),1)]),content:b(()=>[s(c,{inputId:"date",modelValue:o.calendar_visible_to,"onUpdate:modelValue":e[4]||(e[4]=h=>o.calendar_visible_to=h),dateFormat:"dd/mm/yy",manualInput:!0,autofocus:""},null,8,["modelValue"])]),_:1},8,["active"])])])]),_:1})):X("",!0)])]),(i=o.form.location)!=null&&i.id?(U(),Y(r,{key:0},{default:b(()=>[s(g,{header:"Percorsi"},{default:b(()=>{var h;return[s(f,{location_id:(h=o.form.location)==null?void 0:h.id,ref:"courseTable"},null,8,["location_id"])]}),_:1}),s(g,{header:"Aperture"},{default:b(()=>[s(p,{location_id:o.form.location.id},null,8,["location_id"])]),_:1}),s(g,{header:"Eccezioni"},{default:b(()=>[s(a,{location_id:o.form.location.id},null,8,["location_id"])]),_:1}),s(g,{header:"Chiusure"},{default:b(()=>[s(v,{location_id:o.form.location.id},null,8,["location_id"])]),_:1}),s(g,{header:"Punti di accesso"},{default:b(()=>[s(D,{location_id:o.form.location.id},null,8,["location_id"])]),_:1})]),_:1})):X("",!0)])}const hn=J(Xt,[["render",an]]);export{hn as default};
