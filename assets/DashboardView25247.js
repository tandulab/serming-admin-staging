import{D as S,c as V}from"./formatData25247.js";import{u as $,e as N}from"./helpers25247.js";import{x as k,A as L,d as g,c as h,r as f,b as u,m as I,w as i,f as d,g as n,t as p,h as C,o as F,l as O,a as P,i as w,_ as B,e as b,p as x}from"../index25247.js";import{u as M}from"./configuration25247.js";import{u as J}from"./order25247.js";class T{static async fetchAllReveliaDashboard(e){return(await k("/admin/dashboards",e)).data}static async fetchAllDashboard(e){return(await k("/admin/dashboard",e)).data}static async initDashboard(e){return(await k(`/admin/dashboard/init?location_id=${e}`)).data}}const A=L({id:"dashboard",state:()=>({dashboard:{},dashboards:[],response_dashboards:{},courses:[]}),getters:{allDashboards:o=>o.dashboard,responseDashboards:o=>o.response_dashboards,getCurrentDashboard:o=>o.dashboard},actions:{async fetchAllReveliaDashboard(o){await T.fetchAllReveliaDashboard(o).then(e=>{this.response_dashboards=e,this.dashboard=this.response_dashboards.dashboard})},async fetchAllDashboard(o){await T.fetchAllDashboard(o).then(e=>{this.dashboard=e})},async initDashboard(o){await T.initDashboard(o).then(e=>{this.courses=e})}}}),R={class:"pl-4"},U={class:"pl-4"},E=g({__name:"DashboardTable",props:{course:{}},setup(o){const e=o,m=A(),c=h(()=>m.allDashboards),v=h(()=>{var a;if(!((a=c.value)!=null&&a.report)||!e.course)return[];const s=c.value.report[e.course];return!s||!s.tickets?[]:Object.entries(s.tickets).map(([t,l])=>({ticketType:t,total_tickets:l.total_tickets??0,total_amount:l.total_amount??0,visitors_count:l.visitors_count??0}))}),D=h(()=>{var a,t;const s=(t=(a=c.value)==null?void 0:a.report)==null?void 0:t[e.course];return s?Number(s.total_amount??0):0}),_=h(()=>{var a,t;const s=(t=(a=c.value)==null?void 0:a.report)==null?void 0:t[e.course];return s?Number(s.total_tickets??0):0}),r=h(()=>{var a,t;const s=(t=(a=c.value)==null?void 0:a.report)==null?void 0:t[e.course];return s?Number(s.total_visitors??0):0});return(s,a)=>{const t=f("Column"),l=f("DataTable");return u(),I(l,{value:v.value,tableStyle:"min-width: 30rem"},{default:i(()=>[d(t,{field:"ticketType",header:"Tipologia Biglietto",footer:"Totale:",footerClass:"font-bold text-right"}),d(t,{field:"visitors_count",header:"Quantità ingressi",footer:"      "+r.value,footerClass:"font-bold"},{body:i(y=>[n("div",R,p(y.data.visitors_count),1)]),_:1},8,["footer"]),d(t,{field:"total_tickets",header:"Quantità venduto",footer:`      ${_.value}`,footerClass:"font-bold"},{body:i(y=>[n("div",U,p(y.data.total_tickets),1)]),_:1},8,["footer"]),d(t,{field:"total_amount",header:"Importo",footer:`€ ${Number(D.value).toFixed(2)}`,footerClass:"font-bold"},{body:i(y=>[n("span",null,"€ "+p(Number(y.data.total_amount).toFixed(2)),1)]),_:1},8,["footer"])]),_:1},8,["value"])}}}),Q=g({__name:"DashboardPaymentsTable",setup(o){const e=A(),m=J(),c=h(()=>e.allDashboards),v=h(()=>m.paymentModeList),D=h(()=>{var r;return((r=c.value)==null?void 0:r.payments)??[]});function _(r){var a;const s=(a=v.value)==null?void 0:a.find(t=>t.id===r);return s?s.label:r}return(r,s)=>{const a=f("Column"),t=f("DataTable");return u(),I(t,{value:D.value,tableStyle:"min-width: 20rem"},{default:i(()=>[d(a,{header:"Metodo di pagamento"},{body:i(l=>[C(p(_(l.data.method)),1)]),_:1}),d(a,{field:"amount",header:"Importo"},{body:i(l=>[n("span",null,"€ "+p(Number(l.data.amount).toFixed(2)),1)]),_:1})]),_:1},8,["value"])}}}),j=g({setup(){F(()=>{o.value.from=S.now().toJSDate(),o.value.to=S.now().toJSDate();const a=JSON.parse(localStorage.getItem("location")||"null");a&&a.id&&(s(a.id),r())});const o=O({}),e=A();M();const{showLoader:m,hideLoader:c}=$(),v=P(),D=h(()=>e.allDashboards),_=h(()=>e.courses||[]),r=async function(){m();const a=new Map;a.set("from",V(o.value.from)),a.set("to",V(o.value.to)),await e.fetchAllDashboard(a).then(()=>{c()}).catch(t=>{c(),N(v,t)})},s=async function(a){await e.initDashboard(a).catch(t=>{N(v,t)})};return w(_,a=>{a.courses&&Array.isArray(a.courses)&&a.courses.length>0&&!o.value.course_name&&(o.value.course_name=a.courses[0].name)}),w(()=>o.value.from,()=>{r()}),w(()=>o.value.to,()=>{r()}),{form:o,dashboards:D,dashboardCourses:_,fetchAllDashboard:r}},components:{DashboardTable:E,DashboardPaymentsTable:Q}});const G={class:"dashboard"},q=n("h1",null,"Dashboard",-1),z={key:0,class:"flex align-items-center"},H={class:"field col-2 flex flex-column"},K=n("label",null,"Dal",-1),W={class:"field col-2 flex flex-column"},X=n("label",null,"Al",-1),Y={key:1},Z={class:"flex align-items-center flex-wrap"},oo={class:"col-4"},ao={key:0},eo={key:1},to={class:"col-4"},so={key:0},no={key:1},ro={class:"col-4"},lo={key:0},io={key:1},co={class:"flex align-items-start flex-wrap"},uo={class:"field flex flex-column col-6 mt-4"},ho={class:"col-8 field flex flex-column"},mo=n("label",{for:"location"},"Percorso",-1),_o={class:"field flex flex-column col-6 mt-4"},bo=n("h3",null,"Incassi per tipologia di pagamento",-1);function fo(o,e,m,c,v,D){const _=f("Calendar"),r=f("Card"),s=f("Dropdown"),a=f("DashboardTable"),t=f("DashboardPaymentsTable");return u(),b("div",G,[q,o.form?(u(),b("div",z,[n("div",H,[K,d(_,{inputId:"date",modelValue:o.form.from,"onUpdate:modelValue":e[0]||(e[0]=l=>o.form.from=l),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])]),n("div",W,[X,d(_,{inputId:"date",modelValue:o.form.to,"onUpdate:modelValue":e[1]||(e[1]=l=>o.form.to=l),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])])])):x("",!0),o.dashboards?(u(),b("div",Y,[n("div",Z,[n("div",oo,[d(r,null,{title:i(()=>[C(" Vendite ONLINE ")]),content:i(()=>[o.dashboards.total_online!==void 0&&o.dashboards.total_online!==null?(u(),b("span",ao," € "+p((+o.dashboards.total_online).toFixed(2)),1)):(u(),b("span",eo,"0"))]),_:1})]),n("div",to,[d(r,null,{title:i(()=>[C(" Vendite IN LOCO ")]),content:i(()=>[o.dashboards.total_ticket_office!==void 0&&o.dashboards.total_ticket_office!==null?(u(),b("span",so," € "+p((+o.dashboards.total_ticket_office).toFixed(2)),1)):(u(),b("span",no,"0"))]),_:1})]),n("div",ro,[d(r,null,{title:i(()=>[C(" Vendite TOTALI ")]),content:i(()=>[o.dashboards.total?(u(),b("span",lo," € "+p((+o.dashboards.total).toFixed(2)||"-"),1)):(u(),b("span",io," 0 "))]),_:1})])]),n("div",co,[n("div",uo,[n("div",ho,[mo,d(s,{modelValue:o.form.course_name,"onUpdate:modelValue":e[2]||(e[2]=l=>o.form.course_name=l),options:o.dashboardCourses.courses,optionLabel:"name",optionValue:"name",placeholder:"",name:"location"},null,8,["modelValue","options"])]),d(a,{course:o.form.course_name},null,8,["course"])]),n("div",_o,[bo,d(t)])])])):x("",!0)])}const ko=B(j,[["render",fo]]);export{ko as default};
