import{u as E}from"./location23877.js";import{D as L,f as Q,a as J,b as U}from"./formatData23877.js";import{u as q}from"./order23877.js";import{u as K}from"./attraction23877.js";import{u as W}from"./guide23877.js";import{o as O,l as y,c as C,i as G,_ as T,r as f,b as V,m as A,w as i,f as a,g as l,e as k,p as F,h as D,t as p,a as N,q as X,F as Y,n as H,s as Z}from"../index23877.js";import{u as $,p as ee,e as z}from"./helpers23877.js";import{F as oe}from"./vee-validate.esm23877.js";const te={props:["revelia"],setup(v,o){O(()=>{x()});const s=y({}),e=E(),b=K(),g=q(),u=W(),r=y([{name:"In attesa di conferma",value:"added"},{name:"Confermato",value:"confirmed"},{name:"Non Confermato",value:"canceled"}]),c=C(()=>e.allLocations),d=C(()=>b.allAttractions),_=C(()=>g.paymentStatus),t=C(()=>g.paymentStatusRevelia),n=C(()=>u.responseGuides),x=function(){v.revelia?(!d.value||d.value.length==0?M():(s.value.attraction=d.value[0],w()),P()):c.value?(s.value.location=c.value[0],w()):B()},w=function(){const I=L.local(),j=I.minus({months:1}).startOf("month");s.value.date_from=j.toFormat("dd/LL/yyyy"),s.value.date_to=I.toFormat("dd/LL/yyyy"),s.value.status=null,s.value.code="",s.value.user="",s.value.name="",s.value.guide=null,s.value.guide_id=null,s.value.attraction_id=null,s.value.event_status=null,o.emit("onSubmit",s.value)},R=function(){x()},B=async function(){await e.fetchAllLocations()},M=async function(){await b.fetchAllAttractions()},P=async function(){await u.fetchAllGuides()};return G(c,()=>{s.value.location_id=c.value[0].id,s.value.location=c.value[0],w()}),G(d,()=>{s.value.attraction_id=d.value[0].id,s.value.attraction=d.value[0],w()}),{form:s,event_statuses:r,locations:c,attractions:d,statuses:_,statusesRevelia:t,responseGuides:n,resetForm:R}}},ae={class:"formgrid grid px-0 align-items-center"},ne={class:"field col-3 flex flex-column"},le=l("label",{for:"typology"},"Location",-1),se={class:"field col-2"},re=l("label",{from:"date_from"},"Dal",-1),de={class:"field col-2"},ie=l("label",{from:"date_to"},"Al",-1),ue={key:0,class:"field col-3 flex flex-column"},ce=l("label",{from:"status"},"Codice prenotazione",-1),me={key:1,class:"field col-3 flex flex-column"},fe=l("label",{from:"status"},"Acquirente",-1),_e={key:2,class:"field col-2 flex flex-column"},ve=l("label",{from:"guide"},"Guida",-1),pe={class:"flex align-items-center"},ye={class:"field col-2 flex flex-column"},be=l("label",{from:"status"},"Stato pagamento",-1),he={key:3,class:"field col-2 flex flex-column"},ge=l("label",{from:"event_status"},"Stato evento",-1),xe={class:"flex col-12 justify-content-end pt-1"};function Ve(v,o,s,e,b,g){const u=f("Dropdown"),r=f("Calendar"),c=f("InputText"),d=f("Button"),_=f("AccordionTab"),t=f("Accordion");return V(),A(t,{activeIndex:0},{default:i(()=>[a(_,{header:"FILTRI"},{default:i(()=>[l("div",ae,[l("div",ne,[le,s.revelia?(V(),A(u,{key:1,modelValue:e.form.attraction,"onUpdate:modelValue":o[1]||(o[1]=n=>e.form.attraction=n),options:e.attractions,optionLabel:"name"},null,8,["modelValue","options"])):(V(),A(u,{key:0,modelValue:e.form.location,"onUpdate:modelValue":o[0]||(o[0]=n=>e.form.location=n),options:e.locations,optionLabel:"name"},null,8,["modelValue","options"]))]),l("div",se,[re,a(r,{inputId:"date_from",modelValue:e.form.date_from,"onUpdate:modelValue":o[2]||(o[2]=n=>e.form.date_from=n),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])]),l("div",de,[ie,a(r,{inputId:"date_to",modelValue:e.form.date_to,"onUpdate:modelValue":o[3]||(o[3]=n=>e.form.date_to=n),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])]),s.revelia?F("",!0):(V(),k("div",ue,[ce,a(c,{type:"text",modelValue:e.form.code,"onUpdate:modelValue":o[4]||(o[4]=n=>e.form.code=n)},null,8,["modelValue"])])),s.revelia?F("",!0):(V(),k("div",me,[fe,a(c,{type:"text",modelValue:e.form.name,"onUpdate:modelValue":o[5]||(o[5]=n=>e.form.name=n)},null,8,["modelValue"])])),s.revelia?(V(),k("div",_e,[ve,a(u,{id:"guide",modelValue:e.form.guide,"onUpdate:modelValue":o[6]||(o[6]=n=>e.form.guide=n),options:e.responseGuides.guides},{value:i(n=>{var x,w;return[D(p((x=n.value)==null?void 0:x.first_name)+" "+p((w=n.value)==null?void 0:w.last_name),1)]}),option:i(n=>[l("div",pe,[l("div",null,p(n.option.first_name)+" "+p(n.option.last_name),1)])]),_:1},8,["modelValue","options"])])):F("",!0),l("div",ye,[be,a(u,{id:"status",modelValue:e.form.status,"onUpdate:modelValue":o[7]||(o[7]=n=>e.form.status=n),options:s.revelia?e.statusesRevelia:e.statuses,optionLabel:"name",optionValue:"id",placeholder:""},null,8,["modelValue","options"])]),s.revelia?(V(),k("div",he,[ge,a(u,{id:"event_status",modelValue:e.form.event_status,"onUpdate:modelValue":o[8]||(o[8]=n=>e.form.event_status=n),options:e.event_statuses,optionLabel:"name",optionValue:"value"},null,8,["modelValue","options"])])):F("",!0)]),l("div",xe,[a(d,{label:"Ricerca",class:"mr-2",onClick:o[9]||(o[9]=n=>v.$emit("onSubmit",e.form))}),a(d,{label:"Annulla",class:"p-button-outlined",onClick:o[10]||(o[10]=n=>e.resetForm())})])]),_:1})]),_:1})}const we=T(te,[["render",Ve]]),De={props:["filters"],setup(v,o){O(()=>{_.value=!0,t.value={first:0,rows:r.value.rows,sortField:null,sortOrder:null},t.value.page=0});const s=q(),{showLoader:e,hideLoader:b}=$(),g=C(()=>s.responseOrders),u=N(),r=y(),c=y(),d=y(),_=y(!0),t=y(),n=y(0),x=y([]);function w(){_.value=!0,setTimeout(()=>{B()},Math.random()*1e3+250)}const R=function(m){Object.entries(v.filters).forEach(([h,S])=>{S&&((h=="date_from"||h=="date_to")&&S?m.set(h,U(S)):h=="location"?m.set("location_id",S.id):h=="code"?m.set("name",S):m.set(h,S))}),m.delete("guide"),m.set("page",t.value.page+1),m.set("per_page",t.value.rows)},B=async function(){const m=new Map;R(m),await s.fetchAllOrders(m).then(()=>{_.value=!1}).catch(h=>{_.value=!1,z(u,h)})};return{dt:r,responseOrders:g,loading:_,totalRecords:n,lazyParams:t,currentOrder:c,op:d,expandedRows:x,loadLazyData:w,toggle:m=>{d.value.toggle(m)},openDialog:function(m){const h={course_name:m.course_name,start_at:m.start_at};o.emit("updateFilters",h)},onPage:m=>{t.value=m,w()},openPDF:function(m){window.open(m,"_blank")},downloadCsv:async function(){const m=new Map;R(m),m.set("format","csv"),e(),await s.downloadOrderCsv(m).then(()=>{b()}).catch(h=>{b(),z(u,h)})},formatDataAndHourFromUnixTimestamps:Q,formatPrettyDate:J,prettyPaymentStatus:ee}}};const ke={class:"flex justify-content-end mt-4 mb-3"},Se={class:"order-table"},Ce=["href"],Fe=["href"],Re={key:0},Ae=l("div",{class:"flex justify-content-center w-full"},"PDF",-1),Oe={class:"flex justify-content-center"},Te={class:"flex justify-content-end"},Be={class:"col-4 pl-6"};function Ie(v,o,s,e,b,g){const u=f("Button"),r=f("Column"),c=f("Badge"),d=f("DataTable"),_=X("tooltip");return V(),k(Y,null,[l("div",ke,[a(u,{label:"CSV Prenotazioni",icon:"pi pi-download",rounded:"",outlined:"",onClick:o[0]||(o[0]=t=>e.downloadCsv())})]),l("div",Se,[a(d,{value:e.responseOrders.orders,totalRecords:e.responseOrders.total,lazy:!0,paginator:!0,rows:30,ref:"dt",loading:e.loading,stripedRows:"",onPage:o[1]||(o[1]=t=>e.onPage(t)),expandedRows:e.expandedRows,"onUpdate:expandedRows":o[2]||(o[2]=t=>e.expandedRows=t)},{empty:i(()=>[D(" Nessuna prenotazione trovata. ")]),expansion:i(t=>[a(d,{value:t.data.order_items[0].tickets,class:"m-4 mx-4"},{empty:i(()=>[D(" Nessuna prenotazione trovata. ")]),footer:i(()=>[l("div",Te,[l("div",Be,"Totale: € "+p((+t.data.total).toFixed(2)),1)])]),default:i(()=>[a(r,{header:"Tipo biglietto"},{body:i(({data:n})=>[a(c,{value:n.name,class:H([n.name,"px-3 border-round-lg"])},null,8,["value","class"])]),_:1}),a(r,{header:"Orario visita"},{body:i(()=>[D(p(t.data.order_items[0].time_slot.start_at),1)]),_:2},1024),a(r,{header:"Quantità"},{body:i(({data:n})=>[D(p(n.quantity),1)]),_:1}),a(r,{header:"Prezzo"},{body:i(({data:n})=>[D(" € "+p((+n.price).toFixed(2)),1)]),_:1}),a(r,{field:"tickets_url"},{header:i(()=>[Ae]),body:i(({data:n})=>[l("div",Oe,[Z(a(u,{link:"",icon:"pi pi-print",href:n.tickets_url,target:"_blank",style:{color:"var(--surface-400)"},text:"",rounded:"",onClick:x=>e.openPDF(t.data.tickets_url)},null,8,["href","onClick"]),[[_,"Stampa",void 0,{top:!0}]])])]),_:2},1024)]),_:2},1032,["value"])]),default:i(()=>[a(r,{header:"Codice prenotazione",field:"reservation_number",ref:"reservation_number"},null,512),a(r,{header:"Effettuata da",field:"created_by",ref:"created_by"},{body:i(({data:t})=>[D(p(t.user_name)+" "+p(t.user_surname),1)]),_:1},512),a(r,{header:"Email",field:"user_email",ref:"user_email"},{body:i(({data:t})=>[l("a",{href:"https://mail.google.com/mail/?view=cm&fs=1&tf=1&to="+t.user_email,target:"_blank"},p(t.user_email),9,Ce)]),_:1},512),a(r,{header:"Telefono",field:"user_phone"},{body:i(({data:t})=>[l("a",{href:"https://api.whatsapp.com/send?phone="+t.user_phone,target:"_blank"},p(t.user_phone),9,Fe)]),_:1}),a(r,{header:"Data prenotazione",field:"created_at",ref:"created_at"},{body:i(({data:t})=>{var n,x;return[D(p(e.formatPrettyDate((x=(n=t.order_items[0])==null?void 0:n.time_slot)==null?void 0:x.date)),1)]}),_:1},512),a(r,{header:"Data ordine",field:"created_at",ref:"created_at"},{body:i(({data:t})=>[D(p(e.formatDataAndHourFromUnixTimestamps(t.created_at)),1)]),_:1},512),a(r,{header:"Stato"},{body:i(({data:t})=>[t.status?(V(),k("div",Re,[a(c,{value:e.prettyPaymentStatus(t.status),class:H([t.status,"px-3 border-round-lg"])},null,8,["value","class"])])):F("",!0)]),_:1}),a(r,{expander:"",style:{width:"5rem"}})]),_:1},8,["value","totalRecords","loading","expandedRows"])])],64)}const Le=T(De,[["render",Ie]]),Ue={props:["location"],setup(v,o){O(()=>{e.value.start_date=L.local().startOf("day").toFormat("dd/MM/yyyy"),e.value.end_date=L.local().endOf("day").toFormat("dd/MM/yyyy"),e.value.created_at="true",e.value.start_hour="00:00",e.value.end_hour="23:59"});const s=N(),e=y({}),b=E(),g=function(){let c=U(e.value.start_date)+" "+e.value.start_hour,d=U(e.value.end_date)+" "+e.value.end_hour;const _={from:c,to:d,location_id:v.location.id,location_permalink:v.location.permalink,created_at:e.value.created_at};u(_)},u=async function(c){await b.downloadReport(c).then(()=>{o.emit("onSubmit")}).catch(d=>{z(s,d)})};return{form:e,onSubmit:g,setDefaultIfBlank:function(){(!e.value.start_hour||e.value.start_hour=="")&&(e.value.start_hour="00:00"),(!e.value.end_hour||e.value.end_hour=="")&&(e.value.end_hour="23:59")}}},components:{Form:oe}},ze={class:"formgrid grid mt-3"},Me={class:"field col-6 flex flex-column"},Pe=l("label",{from:"start_date"},"Dal",-1),je=l("label",{from:"start_hour",class:"mt-3"},"Dalle",-1),Ge={class:"field col-6 flex flex-column"},He=l("label",{from:"end_date"},"Al",-1),Ee=l("label",{from:"end_hour",class:"mt-3"},"Alle",-1),qe={class:"flex flex-wrap gap-3 mt-3"},Ne={class:"flex align-items-center"},Qe=l("label",{for:"vendite",class:"ml-2"},"Report vendite",-1),Je={class:"flex align-items-center"},Ke=l("label",{for:"prenotazioni",class:"ml-2"},"Report visite",-1),We={class:"flex align-items-center justify-content-end mt-6"};function Xe(v,o,s,e,b,g){const u=f("Calendar"),r=f("InputMask"),c=f("RadioButton"),d=f("Button"),_=f("Form");return V(),A(_,{onSubmit:e.onSubmit},{default:i(()=>[l("div",ze,[l("div",Me,[Pe,a(u,{inputId:"start_date",modelValue:e.form.start_date,"onUpdate:modelValue":o[0]||(o[0]=t=>e.form.start_date=t),dateFormat:"dd/mm/yy",manualInput:!0},null,8,["modelValue"]),je,a(r,{id:"start_hour",modelValue:e.form.start_hour,"onUpdate:modelValue":o[1]||(o[1]=t=>e.form.start_hour=t),mask:"99:99",placeholder:"HH:mm",onBlur:o[2]||(o[2]=t=>e.setDefaultIfBlank())},null,8,["modelValue"])]),l("div",Ge,[He,a(u,{inputId:"end_date",modelValue:e.form.end_date,"onUpdate:modelValue":o[3]||(o[3]=t=>e.form.end_date=t),dateFormat:"dd/mm/yy",manualInput:!0},null,8,["modelValue"]),Ee,a(r,{id:"end_hour",modelValue:e.form.end_hour,"onUpdate:modelValue":o[4]||(o[4]=t=>e.form.end_hour=t),mask:"99:99",placeholder:"HH:mm",onBlur:o[5]||(o[5]=t=>e.setDefaultIfBlank())},null,8,["modelValue"])])]),l("div",qe,[l("div",Ne,[a(c,{modelValue:e.form.created_at,"onUpdate:modelValue":o[6]||(o[6]=t=>e.form.created_at=t),inputId:"vendite",name:"vendite",value:"true"},null,8,["modelValue"]),Qe]),l("div",Je,[a(c,{modelValue:e.form.created_at,"onUpdate:modelValue":o[7]||(o[7]=t=>e.form.created_at=t),inputId:"prenotazioni",name:"prenotazioni",value:"false"},null,8,["modelValue"]),Ke])]),l("div",We,[a(d,{label:"Annulla",text:"",onClick:o[8]||(o[8]=t=>v.$emit("onSubmit"))}),a(d,{label:"Scarica",type:"submit"})])]),_:1},8,["onSubmit"])}const Ye=T(Ue,[["render",Xe]]),Ze={setup(){O(()=>{});const v=y({}),o=y(),s=y(!1),e=y(!1);return{form:v,orderTable:o,isRevelia:s,visibleDialog:e,filterTable:function(u){v.value=u,o.value.loadLazyData()},onCloseReportDialog:function(){e.value=!1}}},components:{OrderFilter:we,OrderTable:Le,SalesReportsDialog:Ye}},$e={class:"flex justify-content-between align-items-center"},eo=l("h1",null,"Prenotazioni e incassi",-1);function oo(v,o,s,e,b,g){const u=f("Button"),r=f("SalesReportsDialog"),c=f("Dialog"),d=f("OrderFilter"),_=f("OrderTable");return V(),k("div",null,[l("div",$e,[eo,a(u,{label:"Report",link:"",class:"m-0 p-0",icon:"pi pi-download",onClick:o[0]||(o[0]=t=>e.visibleDialog=!0)}),a(c,{visible:e.visibleDialog,"onUpdate:visible":o[2]||(o[2]=t=>e.visibleDialog=t),modal:"",header:"Report",style:{width:"35rem"}},{default:i(()=>[a(r,{onOnSubmit:o[1]||(o[1]=t=>e.onCloseReportDialog()),location:e.form.location},null,8,["location"])]),_:1},8,["visible"])]),a(d,{onOnSubmit:o[3]||(o[3]=t=>e.filterTable(t)),revelia:e.isRevelia},null,8,["revelia"]),a(_,{filters:e.form,ref:"orderTable"},null,8,["filters"])])}const mo=T(Ze,[["render",oo]]);export{mo as default};
