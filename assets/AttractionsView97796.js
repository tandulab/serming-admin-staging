import{o as T,a as I,l as f,c as C,v as z,i as U,_ as L,r as d,q,b as j,m as F,w as h,h as M,f as i,g as p,s as E,e as P}from"../index97796.js";import{e as y,p as W,a as $,s as w,u as R}from"./helpers97796.js";import{f as H,a as G}from"./formatData97796.js";import{u as N}from"./attraction97796.js";import{c as J,a as x}from"./index.esm97796.js";import{F as K}from"./vee-validate.esm97796.js";import{I as Q}from"./InputTextWithValidation97796.js";import{u as X}from"./category97796.js";import"./_commonjsHelpers97796.js";/* empty css                                                                            */const Y={props:["attraction_id"],setup(m){T(()=>{o.value=!0,c.value={first:0,rows:a.value.rows,sortField:null,sortOrder:null},c.value.page=0,D()});const t=I(),a=f(),e=f(),g=f(),v=f(),o=f(!0),c=f(),r=f(0),u=N(),l=C(()=>u.responseAttractions),n=z(),_=C(()=>n.submitDialog);function D(){o.value=!0,setTimeout(()=>{A()},Math.random()*1e3+250)}const A=async function(){await u.fetchAllAttractions().then(()=>{o.value=!1}).catch(s=>{o.value=!1,y(t,s)})},B=function(s){v.value=s;let k="Sei sicuro di voler eliminare questo bene?";n.setDialog("Elimina bene","Elimina","Annulla",k),n.setBtnSubmit(!1),n.setDynamicDialogVisibility(!0)},b=async function(){await u.deleteAttraction(v.value).then(()=>{o.value=!1,w(t,{message:"Bene eliminato correttamente",error:!1}),D()}).catch(s=>{o.value=!1,y(t,s)})},S=function(s){s.online?V(s):O(s)},V=async function(s){await u.publishAttraction(s).then(()=>{o.value=!1,w(t,{message:"Bene attivato correttamente",error:!1}),A()}).catch(k=>{o.value=!1,y(t,k)})},O=async function(s){await u.unpublishAttraction(s).then(()=>{o.value=!1,w(t,{message:"Bene disattivato correttamente",error:!1}),A()}).catch(k=>{o.value=!1,y(t,k)})};return U(_,s=>{s&&b()}),{dt:a,responseAttractions:l,loading:o,totalRecords:r,lazyParams:c,currentOrder:e,op:g,loadLazyData:D,onDeleteAttraction:b,confirmDelete:B,changeStatus:S,formatDataAndHourFromUnixTimestamps:H,formatPrettyDate:G,prettyPaymentStatus:W,prettyTicketType:$}}},Z={class:"flex justify-content-center"};function tt(m,t,a,e,g,v){const o=d("Column"),c=d("InputSwitch"),r=d("Button"),u=d("DataTable"),l=q("tooltip");return j(),F(u,{value:e.responseAttractions.attractions,lazy:!0,paginator:!1,ref:"dt",loading:e.loading,stripedRows:""},{empty:h(()=>[M(" Nessun bene trovato. ")]),default:h(()=>[i(o,{header:"Nome",field:"name"}),i(o,{header:"Link prenotazione biglietti",field:"permalink"}),i(o,{header:""},{body:h(({data:n})=>[i(c,{modelValue:n.online,"onUpdate:modelValue":_=>n.online=_,onChange:_=>e.changeStatus(n)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),i(o,{header:""},{body:h(({data:n})=>[p("div",Z,[E(i(r,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:_=>m.$emit("onEdit",n)},null,8,["onClick"]),[[l,"Modifica",void 0,{top:!0}]]),E(i(r,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:_=>e.confirmDelete(n.id)},null,8,["onClick"]),[[l,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"])}const et=L(Y,[["render",tt]]),ot={props:["attraction"],setup(m,t){T(()=>{var b;m.attraction&&m.attraction.id&&(a.value=Object.assign({},m.attraction),a.value.price=(b=a.value.ticket_configurations[0])==null?void 0:b.price,delete a.value.ticket_configurations),A()});const a=f({}),e=J({name:x().required("Nome bene obbligatorio"),address:x().required("Luogo di ritrovo obbligatorio"),price:x().required("Importo biglietto obbligatorio")}),{showLoader:g,hideLoader:v}=R(),o=I(),c=N(),r=X(),u=C(()=>c.allAttractions),l=C(()=>r.allCategories),n=function(){g();const b=Object.assign({},a.value);b.ticket_configurations=[{price:b.price,name:"Biglietto intero"}];const S={attraction:b};c.addAttraction(S).then(()=>{v(),w(o,{message:"Bene aggiunto correttamente",error:!1}),t.emit("onSubmit")}).catch(V=>{v(),y(o,V)})},_=function(){g();const S={attraction:Object.assign({},a.value)};c.updateAttraction(S).then(()=>{v(),w(o,{message:"Chiusura modificata correttamente",error:!1}),t.emit("onSubmit")}).catch(V=>{v(),y(o,V)})},D=function(){a.value.id?_():n()},A=async function(){await r.fetchAllCategories()},B=function(){t.emit("onSubmit",a.value)};return U(l,()=>{a.value.category||(a.value.category=l.value[0])}),{form:a,schema:e,onSubmit:D,resetForm:B,attractions:u,categories:l}},components:{Form:K,InputTextWithValidation:Q}},nt={class:"formgrid grid mt-3"},at={class:"field col-12"},it={class:"field col-12"},lt={class:"field col-12"},rt={class:"field col-12 flex flex-column"},st=p("label",{for:"category"},"Categoria",-1),ct={class:"flex align-items-center col-12"},ut=p("label",{for:"free_ticket",class:"ml-2"}," Biglietto gratuito ",-1),mt={class:"flex align-items-center justify-content-end mt-6"};function dt(m,t,a,e,g,v){const o=d("InputTextWithValidation"),c=d("Dropdown"),r=d("Checkbox"),u=d("Button"),l=d("Form");return j(),F(l,{onSubmit:e.onSubmit,"validation-schema":e.schema},{default:h(()=>[p("div",nt,[p("div",at,[i(o,{name:"name",label:"Nome bene*",modelValue:e.form.name,"onUpdate:modelValue":t[0]||(t[0]=n=>e.form.name=n)},null,8,["modelValue"])]),p("div",it,[i(o,{name:"address",label:"Luogo di ritrovo*",modelValue:e.form.address,"onUpdate:modelValue":t[1]||(t[1]=n=>e.form.address=n)},null,8,["modelValue"])]),p("div",lt,[i(o,{name:"price",label:"Importo biglietto*",modelValue:e.form.price,"onUpdate:modelValue":t[2]||(t[2]=n=>e.form.price=n)},null,8,["modelValue"])]),p("div",rt,[st,i(c,{modelValue:e.form.category,"onUpdate:modelValue":t[3]||(t[3]=n=>e.form.category=n),options:e.categories,optionLabel:"label",optionValue:"value",placeholder:"",name:"category"},null,8,["modelValue","options"])])]),p("div",ct,[i(r,{modelValue:e.form.free_ticket,"onUpdate:modelValue":t[4]||(t[4]=n=>e.form.free_ticket=n),inputId:"free_ticket",binary:""},null,8,["modelValue"]),ut]),p("div",mt,[i(u,{label:"Annulla",text:"",onClick:t[5]||(t[5]=n=>e.resetForm())}),i(u,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit","validation-schema"])}const ft=L(ot,[["render",dt]]),pt={setup(){T(()=>{});const m=f(!1),t=f({}),a=f(),e=f();return{form:t,attractionTable:a,visibleDialog:m,currentAttraction:e,filterTable:function(r){t.value=r,a.value.loadLazyData()},onShowDialog:function(){e.value={},m.value=!0},onEdit:function(r){e.value=r,m.value=!0},onSubmit:function(){a.value.loadLazyData(),m.value=!1}}},components:{AttractionTable:et,AttractionDialog:ft}},vt=p("h1",null,"Beni",-1),bt={class:"flex justify-content-end mt-4 mb-3"};function gt(m,t,a,e,g,v){const o=d("Button"),c=d("AttractionTable"),r=d("AttractionDialog"),u=d("Dialog");return j(),P("div",null,[vt,p("div",bt,[i(o,{label:"Bene",icon:"pi pi-plus",rounded:"",outlined:"",onClick:t[0]||(t[0]=l=>e.onShowDialog())})]),i(c,{filters:e.form,ref:"attractionTable",onOnEdit:t[1]||(t[1]=l=>e.onEdit(l))},null,8,["filters"]),i(u,{visible:e.visibleDialog,"onUpdate:visible":t[3]||(t[3]=l=>e.visibleDialog=l),modal:"",header:"Bene",style:{width:"35rem"}},{default:h(()=>[i(r,{attraction:e.currentAttraction,onOnSubmit:t[2]||(t[2]=l=>e.onSubmit())},null,8,["attraction"])]),_:1},8,["visible"])])}const Bt=L(pt,[["render",gt]]);export{Bt as default};
