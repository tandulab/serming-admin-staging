import{o as S,a as U,l as _,c as k,v as A,i as M,_ as w,r as c,q as j,b as G,m as T,w as b,h as R,f as a,t as D,g as l,s as x,C as N,e as q,F as z}from"../index25247.js";import{e as y,p as P,a as W,s as F,u as H}from"./helpers25247.js";import{f as J,a as K,D as B,b as E}from"./formatData25247.js";import{u as I}from"./guide25247.js";import{c as Q,a as V}from"./index.esm25247.js";import{F as O}from"./vee-validate.esm25247.js";import{I as X}from"./InputTextWithValidation25247.js";import"./_commonjsHelpers25247.js";/* empty css                                                                            */const Y={setup(){S(()=>{u.value=!0,n.value={first:0,rows:o.value.rows,sortField:null,sortOrder:null},n.value.page=0,v()});const d=U(),o=_(),i=_(),e=_(),p=_(),u=_(!0),n=_(),r=_(0),m=I(),s=k(()=>m.responseGuides),t=A(),f=k(()=>t.submitDialog);function v(){u.value=!0,setTimeout(()=>{h()},Math.random()*1e3+250)}const h=async function(){await m.fetchAllGuides().then(()=>{u.value=!1}).catch(g=>{u.value=!1,y(d,g)})},$=function(g){p.value=g;let L="Sei sicuro di voler eliminare questa guida?";t.setDialog("Elimina guida","Elimina","Annulla",L),t.setBtnSubmit(!1),t.setDynamicDialogVisibility(!0)},C=async function(){await m.deleteGuide(p.value).then(()=>{u.value=!1,F(d,{message:"Guida eliminata correttamente",error:!1}),h()}).catch(g=>{u.value=!1,y(d,g)})};return M(f,g=>{g&&C()}),{dt:o,responseGuides:s,loading:u,totalRecords:r,lazyParams:n,currentOrder:i,op:e,loadLazyData:v,onDeleteGuide:C,confirmDelete:$,formatDataAndHourFromUnixTimestamps:J,formatPrettyDate:K,prettyPaymentStatus:P,prettyTicketType:W}}},Z=["href"],ee=["href"],oe={class:"flex justify-content-center"};function te(d,o,i,e,p,u){const n=c("Column"),r=c("Button"),m=c("DataTable"),s=j("tooltip");return G(),T(m,{value:e.responseGuides.guides,lazy:!0,paginator:!1,ref:"dt",loading:e.loading,stripedRows:""},{empty:b(()=>[R(" Nessuna guida trovata. ")]),default:b(()=>[a(n,{header:"Guida",field:"name"},{body:b(({data:t})=>[R(D(t.last_name)+" "+D(t.first_name),1)]),_:1}),a(n,{header:"Email",field:"email"},{body:b(({data:t})=>[l("a",{href:"https://mail.google.com/mail/?view=cm&fs=1&tf=1&to="+t.email,target:"_blank"},D(t.email),9,Z)]),_:1}),a(n,{header:"Telefono",field:"phone_number"},{body:b(({data:t})=>[l("a",{href:"https://api.whatsapp.com/send?phone="+t.phone_number,target:"_blank"},D(t.phone_number),9,ee)]),_:1}),a(n,{header:"Ente",field:"notes"}),a(n,{header:""},{body:b(({data:t})=>[l("div",oe,[x(a(r,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:f=>d.$emit("onEdit",t)},null,8,["onClick"]),[[s,"Modifica",void 0,{top:!0}]]),x(a(r,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:f=>e.confirmDelete(t.id)},null,8,["onClick"]),[[s,"Elimina",void 0,{top:!0}]]),x(a(r,{link:"",icon:"pi pi-download",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:f=>d.$emit("onDownloadReport",t)},null,8,["onClick"]),[[s,"Download Report",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"])}const ne=w(Y,[["render",te]]),ae={props:["guide"],setup(d,o){S(()=>{d.guide&&(i.value=Object.assign({},d.guide))});const i=_({}),e=Q({first_name:V().required("Nome obbligatorio"),last_name:V().required("Cognome obbligatorio"),email:V().required("Email obbligatoria")}),{showLoader:p,hideLoader:u}=H(),n=U(),r=I(),m=function(){p();const v={guide:i.value};r.addGuide(v).then(()=>{u(),F(n,{message:"Guida aggiunta correttamente",error:!1}),o.emit("onSubmit")}).catch(h=>{y(n,h)})},s=function(){p();const v={guide:i.value};r.updateGuide(v).then(()=>{u(),F(n,{message:"Guida modificata correttamente",error:!1}),o.emit("onSubmit")}).catch(h=>{u(),y(n,h)})};return{form:i,schema:e,onSubmit:function(){i.value.id?s():m()},resetForm:function(){o.emit("onSubmit",i.value)}}},components:{Form:O,InputTextWithValidation:X}},ie={class:"formgrid grid mt-3"},le={class:"field col-6 flex flex-column mb-0"},se={class:"field col-6 mb-0"},de={class:"formgrid grid"},re={class:"field col-6 flex flex-column"},ue={class:"field col-6 flex flex-column"},me=l("label",{for:"phone_number"},"Telefono",-1),ce={class:"formgrid grid"},fe={class:"field col-12 flex flex-column"},_e=l("label",{for:"notes"},"Ente",-1),pe={class:"flex align-items-center justify-content-end mt-6"};function be(d,o,i,e,p,u){const n=c("InputTextWithValidation"),r=c("InputText"),m=c("Button"),s=c("Form");return G(),T(s,{"validation-schema":e.schema,onSubmit:e.onSubmit},{default:b(()=>[l("div",ie,[l("div",le,[a(n,{name:"first_name",label:"Nome*",modelValue:e.form.first_name,"onUpdate:modelValue":o[0]||(o[0]=t=>e.form.first_name=t)},null,8,["modelValue"])]),l("div",se,[a(n,{name:"last_name",label:"Cognome*",modelValue:e.form.last_name,"onUpdate:modelValue":o[1]||(o[1]=t=>e.form.last_name=t)},null,8,["modelValue"])])]),l("div",de,[l("div",re,[a(n,{name:"email",label:"Email*",modelValue:e.form.email,"onUpdate:modelValue":o[2]||(o[2]=t=>e.form.email=t)},null,8,["modelValue"])]),l("div",ue,[me,a(r,{name:"phone_number",modelValue:e.form.phone_number,"onUpdate:modelValue":o[3]||(o[3]=t=>e.form.phone_number=t)},null,8,["modelValue"])])]),l("div",ce,[l("div",fe,[_e,a(r,{name:"notes",modelValue:e.form.notes,"onUpdate:modelValue":o[4]||(o[4]=t=>e.form.notes=t)},null,8,["modelValue"])])]),l("div",pe,[a(m,{label:"Annulla",text:"",onClick:o[5]||(o[5]=t=>e.resetForm())}),a(m,{label:"Conferma",type:"submit"})])]),_:1},8,["validation-schema","onSubmit"])}const ge=w(ae,[["render",be]]),ve={props:["guide"],setup(d,o){S(()=>{i.value.start_date=B.now().minus({months:1}).toFormat("dd/MM/yyyy"),i.value.end_date=B.now().toFormat("dd/MM/yyyy")});const i=_({});return{form:i,onSubmit:function(){let u="/admin/guides/download?start_date="+E(i.value.start_date)+"&end_date="+E(i.value.end_date)+"&guide_id="+d.guide.id;N.get(u,{responseType:"blob"}).then(n=>{var r=new Blob([n.data],{type:"application/pdf"}),m=URL.createObjectURL(r);window.open(m),o.emit("onSubmit")})},resetForm:function(){o.emit("onSubmit",i.value)}}},components:{Form:O}},he={class:"formgrid grid mt-3"},De={class:"field col-6 flex flex-column"},ye=l("label",{from:"start_date"},"Filtra Dal",-1),Se={class:"field col-6 flex flex-column"},we=l("label",{from:"end_date"},"Al",-1),Ge={class:"flex align-items-center justify-content-end mt-6"};function xe(d,o,i,e,p,u){const n=c("Calendar"),r=c("Button"),m=c("Form");return G(),T(m,{onSubmit:e.onSubmit},{default:b(()=>[l("div",he,[l("div",De,[ye,a(n,{inputId:"start_date",modelValue:e.form.start_date,"onUpdate:modelValue":o[0]||(o[0]=s=>e.form.start_date=s),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])]),l("div",Se,[we,a(n,{inputId:"end_date",modelValue:e.form.end_date,"onUpdate:modelValue":o[1]||(o[1]=s=>e.form.end_date=s),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])])]),l("div",Ge,[a(r,{label:"Annulla",text:"",onClick:o[2]||(o[2]=s=>e.resetForm())}),a(r,{label:"Scarica",type:"submit"})])]),_:1},8,["onSubmit"])}const Ve=w(ve,[["render",xe]]),Fe={setup(){S(()=>{});const d=_(!1),o=_(!1),i=_(),e=_({});return{visibleDialog:d,guideTable:i,currentGuide:e,visibleFilterDialog:o,onSubmit:function(){d.value=!1,i.value.loadLazyData(),e.value={}},onShowDialog:function(){e.value={},d.value=!0},onEdit:function(s){e.value=s,d.value=!0},onDownloadReport:function(s){e.value=s,o.value=!0},closeDialog:function(){o.value=!1}}},components:{GuideTable:ne,GuideDialog:ge,ReportGuideDialog:Ve}},Te=l("h1",null,"Guide",-1),Ce={class:"flex justify-content-end mt-4 mb-3"};function ke(d,o,i,e,p,u){const n=c("Button"),r=c("GuideTable"),m=c("GuideDialog"),s=c("Dialog"),t=c("ReportGuideDialog");return G(),q(z,null,[Te,l("div",Ce,[a(n,{label:"Guida",icon:"pi pi-plus",rounded:"",outlined:"",onClick:o[0]||(o[0]=f=>e.onShowDialog())})]),a(r,{ref:"guideTable",onOnEdit:o[1]||(o[1]=f=>e.onEdit(f)),onOnDownloadReport:o[2]||(o[2]=f=>e.onDownloadReport(f))},null,512),a(s,{visible:e.visibleDialog,"onUpdate:visible":o[3]||(o[3]=f=>e.visibleDialog=f),modal:"",header:"Guida",style:{width:"50rem"}},{default:b(()=>[a(m,{guide:e.currentGuide,onOnSubmit:e.onSubmit},null,8,["guide","onOnSubmit"])]),_:1},8,["visible"]),a(s,{visible:e.visibleFilterDialog,"onUpdate:visible":o[4]||(o[4]=f=>e.visibleFilterDialog=f),modal:"",header:"Report guida",style:{width:"50rem"}},{default:b(()=>[a(t,{guide:e.currentGuide,onOnSubmit:e.closeDialog},null,8,["guide","onOnSubmit"])]),_:1},8,["visible"])],64)}const Me=w(Fe,[["render",ke]]);export{Me as default};
