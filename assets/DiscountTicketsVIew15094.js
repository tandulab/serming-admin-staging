import{o as I,a as P,l as v,c as S,v as M,i as z,_ as F,r as m,q as j,b as C,m as U,w as u,h,f as l,t as k,n as E,g as e,s as N,e as G}from"../index15094.js";import{e as w,p as O,a as R,s as A,u as q}from"./helpers15094.js";import{f as H,a as J,D as x,c as B}from"./formatData15094.js";import{u as L}from"./promotion15094.js";import{u as W}from"./location15094.js";import"./index.esm15094.js";import{F as K}from"./vee-validate.esm15094.js";import{I as Q}from"./InputTextWithValidation15094.js";import"./_commonjsHelpers15094.js";/* empty css                                                                            */const X={setup(){I(()=>{f.value=!0,r.value={first:0,rows:t.value.rows,sortField:null,sortOrder:null},r.value.page=0,y()});const b=P(),t=v(),a=v(),o=v(),D=v(),f=v(!0),r=v(),c=v(0),_=L(),p=S(()=>_.responsePromotions),d=M(),i=S(()=>d.submitDialog);function y(){f.value=!0,setTimeout(()=>{V()},Math.random()*1e3+250)}const V=async function(){await _.fetchAllPromotionTickets().then(()=>{f.value=!1}).catch(g=>{f.value=!1,w(b,g)})},n=function(g){D.value=g;let T="Sei sicuro di voler eliminare questo sconto?";d.setDialog("Elimina sconto","Elimina","Annulla",T),d.setBtnSubmit(!1),d.setDynamicDialogVisibility(!0)},s=async function(){await _.deletePromotion(D.value).then(()=>{f.value=!1,A(b,{message:"Sconto eliminato correttamente",error:!1}),V()}).catch(g=>{f.value=!1,w(b,g)})};return z(i,g=>{g&&s()}),{dt:t,responsePromotions:p,loading:f,totalRecords:c,lazyParams:r,currentOrder:a,op:o,loadLazyData:y,onDeletePromotion:s,confirmDelete:n,formatDataAndHourFromUnixTimestamps:H,formatPrettyDate:J,prettyPaymentStatus:O,prettyTicketType:R}}},Y={class:"flex justify-content-center"};function Z(b,t,a,o,D,f){const r=m("Column"),c=m("Badge"),_=m("Button"),p=m("DataTable"),d=j("tooltip");return C(),U(p,{value:o.responsePromotions.promotions,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:""},{empty:u(()=>[h(" Nessuno sconto trovato. ")]),default:u(()=>[l(r,{header:"Location",field:"location"},{body:u(({data:i})=>{var y;return[h(k(((y=i.location)==null?void 0:y.name)||"Tutte le location"),1)]}),_:1}),l(r,{header:"Tipo biglietto"},{body:u(({data:i})=>[l(c,{value:o.prettyTicketType(i.ticket_type),class:E([i.ticket_type,"px-3 border-round-lg"])},null,8,["value","class"])]),_:1}),l(r,{header:"Ordinabile dal - al "},{body:u(({data:i})=>[h(k(o.formatPrettyDate(i.booking_from_date))+" - "+k(o.formatPrettyDate(i.booking_to_date)),1)]),_:1}),l(r,{header:"Valido dal - al "},{body:u(({data:i})=>[h(k(o.formatPrettyDate(i.from_date))+" - "+k(o.formatPrettyDate(i.to_date)),1)]),_:1}),l(r,{header:""},{body:u(({data:i})=>[e("div",Y,[N(l(_,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:y=>o.confirmDelete(i.id)},null,8,["onClick"]),[[d,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"])}const $=F(X,[["render",Z]]),oo={setup(b,t){I(()=>{i.value&&(c.value=[...i.value],c.value.unshift({id:"null",name:"Tutte le location"}),a.value.location_id=c.value[0].id,a.value.promo_type="1",a.value.ticket_type="standard",a.value.from_date=x.local().toFormat("dd/MM/yyyy"),a.value.to_date=x.local().toFormat("dd/MM/yyyy"),a.value.booking_from_date=x.local().toFormat("dd/MM/yyyy"),a.value.booking_to_date=x.local().toFormat("dd/MM/yyyy"))});const a=v({}),o=v(!1),D=W(),f=L(),r=[{label:"Biglietti standard",value:"standard"}],c=v([]),{showLoader:_,hideLoader:p}=q(),d=P(),i=S(()=>D.allLocations);return{visibleDialog:o,form:a,ticket_types:r,options:c,onShowDialog:function(){o.value=!0},onSubmit:function(){if(a.value.promo_type=="1"&&!a.value.price||a.value.promo_type=="2"&&!a.value.discount_1||a.value.promo_type=="3"&&!a.value.discount_2)return;const s=Object.assign({},a.value);s.from_date&&(s.from_date=B(s.from_date)),s.to_date&&(s.to_date=B(s.to_date)),(a.value.promo_type=="2"||a.value.promo_type=="3")&&(s.discount=s.discount_2,delete s.discount_1,delete s.discount_2),_();const g={promotion:s};f.addPromotion(g).then(()=>{p(),A(d,{message:"Codice sconto aggiunto correttamente",error:!1}),t.emit("closeDialog")}).catch(T=>{p(),w(d,T)})},resetForm:function(){t.emit("onSubmit",a.value)}}},components:{Form:K,InputTextWithValidation:Q}},to={class:"formgrid grid flex-column mt-3"},eo={class:"field col-12 flex flex-column"},lo=e("label",{for:"location"},"Seleziona la location",-1),no={class:"formgrid grid mt-2"},ao=e("div",{class:"field col-12 flex flex-column mb-0"},[e("label",null,"Data prenotazione (giorno in cui si può effettuare la prenotazione)")],-1),io={class:"field col-6 flex flex-column"},so=e("label",{from:"booking_from_date"},"Dal",-1),ro={class:"field col-6 flex flex-column"},mo=e("label",{from:"booking_to_date"},"Al",-1),co={class:"formgrid grid mt-2"},uo=e("div",{class:"field col-12 flex flex-column mb-0"},[e("label",null,"Data visita (giorno in cui si effettuerà la visita)")],-1),_o={class:"field col-6 flex flex-column"},fo=e("label",{from:"from_date"},"Dal",-1),po={class:"field col-6 flex flex-column"},vo=e("label",{from:"to_date"},"Al",-1),bo={class:"formgrid grid mt-2"},yo={class:"field col-12 flex flex-column"},go=e("label",{for:"ticket_type"},"Tipo di biglietto",-1),Do={class:"ml-3 mt-3"},ho=e("label",null,"Tipo di promozione",-1),Vo={class:"flex flex-wrap gap-3 mt-3 flex-column"},ko={class:"flex align-items-center"},xo=e("label",{for:"2",class:"ml-2 mr-2"},"Tutti i biglietti costano",-1),To={class:"flex align-items-center"},So=e("label",{for:"2",class:"ml-2 mr-2"},"Tutti i biglietti costano",-1),wo=e("span",{class:"ml-2"},"in meno",-1),Io={class:"flex align-items-center"},Fo=e("label",{for:"3",class:"ml-2 mr-2"},"Tutti i biglietti costano il ",-1),Co=e("span",{class:"ml-2"},"in meno",-1),Bo={class:"flex align-items-center justify-content-end mt-6"};function Po(b,t,a,o,D,f){const r=m("Dropdown"),c=m("Calendar"),_=m("RadioButton"),p=m("InputText"),d=m("InputGroupAddon"),i=m("InputGroup"),y=m("Button"),V=m("Form");return C(),U(V,{onSubmit:o.onSubmit},{default:u(()=>[e("div",to,[e("div",eo,[lo,l(r,{modelValue:o.form.location_id,"onUpdate:modelValue":t[0]||(t[0]=n=>o.form.location_id=n),options:o.options,optionLabel:"name",optionValue:"id",placeholder:"",name:"location"},null,8,["modelValue","options"])])]),e("div",no,[ao,e("div",io,[so,l(c,{inputId:"booking_from_date",modelValue:o.form.booking_from_date,"onUpdate:modelValue":t[1]||(t[1]=n=>o.form.booking_from_date=n),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])]),e("div",ro,[mo,l(c,{inputId:"booking_to_date",modelValue:o.form.booking_to_date,"onUpdate:modelValue":t[2]||(t[2]=n=>o.form.booking_to_date=n),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])])]),e("div",co,[uo,e("div",_o,[fo,l(c,{inputId:"from_date",modelValue:o.form.from_date,"onUpdate:modelValue":t[3]||(t[3]=n=>o.form.from_date=n),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])]),e("div",po,[vo,l(c,{inputId:"to_date",modelValue:o.form.to_date,"onUpdate:modelValue":t[4]||(t[4]=n=>o.form.to_date=n),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])])]),e("div",bo,[e("div",yo,[go,l(r,{modelValue:o.form.ticket_type,"onUpdate:modelValue":t[5]||(t[5]=n=>o.form.ticket_type=n),options:o.ticket_types,optionLabel:"label",optionValue:"value",placeholder:"",name:"ticket_type"},null,8,["modelValue","options"])]),e("div",Do,[ho,e("div",Vo,[e("div",ko,[l(_,{modelValue:o.form.promo_type,"onUpdate:modelValue":t[6]||(t[6]=n=>o.form.promo_type=n),inputId:"1",name:"1",value:"1"},null,8,["modelValue"]),xo,l(i,{class:"w-10rem ml-2"},{default:u(()=>[l(p,{modelValue:o.form.price,"onUpdate:modelValue":t[7]||(t[7]=n=>o.form.price=n),class:"border-noround-right",disabled:o.form.promo_type!="1"},null,8,["modelValue","disabled"]),l(d,null,{default:u(()=>[h("€")]),_:1})]),_:1})]),e("div",To,[l(_,{modelValue:o.form.promo_type,"onUpdate:modelValue":t[8]||(t[8]=n=>o.form.promo_type=n),inputId:"2",name:"2",value:"2"},null,8,["modelValue"]),So,l(i,{class:"w-10rem ml-2"},{default:u(()=>[l(p,{modelValue:o.form.discount_1,"onUpdate:modelValue":t[9]||(t[9]=n=>o.form.discount_1=n),class:"border-noround-right",disabled:o.form.promo_type=="3"},null,8,["modelValue","disabled"]),l(d,null,{default:u(()=>[h("€")]),_:1})]),_:1}),wo]),e("div",Io,[l(_,{modelValue:o.form.promo_type,"onUpdate:modelValue":t[10]||(t[10]=n=>o.form.promo_type=n),inputId:"3",name:"3",value:"3"},null,8,["modelValue"]),Fo,l(i,{class:"w-10rem"},{default:u(()=>[l(p,{modelValue:o.form.discount_2,"onUpdate:modelValue":t[11]||(t[11]=n=>o.form.discount_2=n),class:"border-noround-right",disabled:o.form.promo_type=="2"},null,8,["modelValue","disabled"]),l(d,null,{default:u(()=>[h("%")]),_:1})]),_:1}),Co])])])]),e("div",Bo,[l(y,{label:"Annulla",text:"",onClick:t[12]||(t[12]=n=>o.resetForm())}),l(y,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit"])}const Uo=F(oo,[["render",Po]]),Ao={setup(){I(()=>{});const b=v(!1),t=v();return{visibleDialog:b,discountTicketTable:t,onShowDialog:function(){b.value=!0},onSubmit:function(){b.value=!1,t.value.loadLazyData()}}},components:{DiscountTicketTable:$,DiscountTicketDialog:Uo}},Lo=e("h1",null,"Sconti biglietti",-1),Mo={class:"flex justify-content-end mt-4 mb-3"};function zo(b,t,a,o,D,f){const r=m("Button"),c=m("DiscountTicketTable"),_=m("DiscountTicketDialog"),p=m("Dialog");return C(),G("div",null,[Lo,e("div",Mo,[l(r,{label:"Sconto biglietti",icon:"pi pi-plus",rounded:"",outlined:"",onClick:t[0]||(t[0]=d=>o.onShowDialog())})]),l(c,{ref:"discountTicketTable"},null,512),l(p,{visible:o.visibleDialog,"onUpdate:visible":t[2]||(t[2]=d=>o.visibleDialog=d),modal:"",header:"Nuovo codice sconto",style:{width:"35rem"}},{default:u(()=>[l(_,{onCloseDialog:t[1]||(t[1]=d=>o.onSubmit())})]),_:1},8,["visible"])])}const Ko=F(Ao,[["render",zo]]);export{Ko as default};
