import{D as A,c as S}from"./formatData76527.js";import{u as L,e as N}from"./helpers76527.js";import{x as w,A as $,d as g,c as m,r as f,b as u,m as I,w as i,f as d,g as n,t as v,h as y,o as F,l as O,a as P,i as T,_ as B,e as b,p as x}from"../index76527.js";import{u as M}from"./configuration76527.js";import{u as J}from"./order76527.js";class k{static async fetchAllReveliaDashboard(e){return(await w("/admin/dashboards",e)).data}static async fetchAllDashboard(e){return(await w("/admin/dashboard",e)).data}static async initDashboard(e){return(await w(`/admin/dashboard/init?location_id=${e}`)).data}}const V=$({id:"dashboard",state:()=>({dashboard:{},dashboards:[],response_dashboards:{},courses:[]}),getters:{allDashboards:o=>o.dashboard,responseDashboards:o=>o.response_dashboards,getCurrentDashboard:o=>o.dashboard},actions:{async fetchAllReveliaDashboard(o){await k.fetchAllReveliaDashboard(o).then(e=>{this.response_dashboards=e,this.dashboard=this.response_dashboards.dashboard})},async fetchAllDashboard(o){await k.fetchAllDashboard(o).then(e=>{this.dashboard=e})},async initDashboard(o){await k.initDashboard(o).then(e=>{this.courses=e})}}}),q={class:"pl-4"},R=g({__name:"DashboardTable",props:{course:{}},setup(o){const e=o,h=V(),c=m(()=>h.allDashboards),p=m(()=>{var a;if(!((a=c.value)!=null&&a.report)||!e.course)return[];const s=c.value.report[e.course];return!s||!s.tickets?[]:Object.entries(s.tickets).map(([t,l])=>({ticketType:t,quantity:l.total_tickets??0,amount:l.total_amount??0}))}),D=m(()=>{var a,t;const s=(t=(a=c.value)==null?void 0:a.report)==null?void 0:t[e.course];return s?Number(s.total_amount??0):0}),_=m(()=>{var a,t;const s=(t=(a=c.value)==null?void 0:a.report)==null?void 0:t[e.course];return s?Number(s.total_tickets??0):0}),r=m(()=>{var a,t;const s=(t=(a=c.value)==null?void 0:a.report)==null?void 0:t[e.course];return s?Number(s.visitors_count??0):0});return(s,a)=>{const t=f("Column"),l=f("DataTable");return u(),I(l,{value:p.value,tableStyle:"min-width: 30rem"},{default:i(()=>[d(t,{field:"ticketType",header:"Tipologia Biglietto",footer:"Totale:",footerClass:"font-bold text-right"}),d(t,{field:"quantity",header:"Quantità",footer:"      "+_.value,footerClass:"font-bold"},{body:i(C=>[n("div",q,v(C.data.quantity),1)]),_:1},8,["footer"]),d(t,{field:"amount",header:"Importo",footer:`€ ${Number(D.value).toFixed(2)}`,footerClass:"font-bold"},{body:i(C=>[n("span",null,"€ "+v(Number(C.data.amount).toFixed(2)),1)]),_:1},8,["footer"]),d(t,{field:"visitors_count",header:"Visitatori",footer:`${r.value}`,footerClass:"font-bold"},null,8,["footer"])]),_:1},8,["value"])}}}),U=g({__name:"DashboardPaymentsTable",setup(o){const e=V(),h=J(),c=m(()=>e.allDashboards),p=m(()=>h.paymentModeList),D=m(()=>{var r;return((r=c.value)==null?void 0:r.payments)??[]});function _(r){var a;const s=(a=p.value)==null?void 0:a.find(t=>t.id===r);return s?s.label:r}return(r,s)=>{const a=f("Column"),t=f("DataTable");return u(),I(t,{value:D.value,tableStyle:"min-width: 20rem"},{default:i(()=>[d(a,{header:"Metodo di pagamento"},{body:i(l=>[y(v(_(l.data.method)),1)]),_:1}),d(a,{field:"amount",header:"Importo"},{body:i(l=>[n("span",null,"€ "+v(Number(l.data.amount).toFixed(2)),1)]),_:1})]),_:1},8,["value"])}}}),E=g({setup(){F(()=>{o.value.from=A.now().toJSDate(),o.value.to=A.now().toJSDate();const a=JSON.parse(localStorage.getItem("location")||"null");a&&a.id&&(s(a.id),r())});const o=O({}),e=V();M();const{showLoader:h,hideLoader:c}=L(),p=P(),D=m(()=>e.allDashboards),_=m(()=>e.courses||[]),r=async function(){h();const a=new Map;a.set("from",S(o.value.from)),a.set("to",S(o.value.to)),await e.fetchAllDashboard(a).then(()=>{c()}).catch(t=>{c(),N(p,t)})},s=async function(a){await e.initDashboard(a).catch(t=>{N(p,t)})};return T(_,a=>{a.courses&&Array.isArray(a.courses)&&a.courses.length>0&&!o.value.course_name&&(o.value.course_name=a.courses[0].name)}),T(()=>o.value.from,()=>{r()}),T(()=>o.value.to,()=>{r()}),{form:o,dashboards:D,dashboardCourses:_,fetchAllDashboard:r}},components:{DashboardTable:R,DashboardPaymentsTable:U}});const j={class:"dashboard"},G=n("h1",null,"Dashboard",-1),Q={key:0,class:"flex align-items-center"},z={class:"field col-2 flex flex-column"},H=n("label",null,"Dal",-1),K={class:"field col-2 flex flex-column"},W=n("label",null,"Al",-1),X={key:1},Y={class:"flex align-items-center flex-wrap"},Z={class:"col-4"},oo={key:0},ao={key:1},eo={class:"col-4"},to={key:0},so={key:1},no={class:"col-4"},ro={key:0},lo={key:1},io={class:"flex align-items-start flex-wrap"},co={class:"field flex flex-column col-6 mt-4"},uo={class:"col-8 field flex flex-column"},mo=n("label",{for:"location"},"Percorso",-1),ho={class:"field flex flex-column col-6 mt-4"},_o=n("h3",null,"Incassi per tipologia di pagamento",-1);function bo(o,e,h,c,p,D){const _=f("Calendar"),r=f("Card"),s=f("Dropdown"),a=f("DashboardTable"),t=f("DashboardPaymentsTable");return u(),b("div",j,[G,o.form?(u(),b("div",Q,[n("div",z,[H,d(_,{inputId:"date",modelValue:o.form.from,"onUpdate:modelValue":e[0]||(e[0]=l=>o.form.from=l),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])]),n("div",K,[W,d(_,{inputId:"date",modelValue:o.form.to,"onUpdate:modelValue":e[1]||(e[1]=l=>o.form.to=l),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])])])):x("",!0),o.dashboards?(u(),b("div",X,[n("div",Y,[n("div",Z,[d(r,null,{title:i(()=>[y(" Vendite ONLINE ")]),content:i(()=>[o.dashboards.total_online!==void 0&&o.dashboards.total_online!==null?(u(),b("span",oo," € "+v((+o.dashboards.total_online).toFixed(2)),1)):(u(),b("span",ao,"0"))]),_:1})]),n("div",eo,[d(r,null,{title:i(()=>[y(" Vendite IN LOCO ")]),content:i(()=>[o.dashboards.total_ticket_office!==void 0&&o.dashboards.total_ticket_office!==null?(u(),b("span",to," € "+v((+o.dashboards.total_ticket_office).toFixed(2)),1)):(u(),b("span",so,"0"))]),_:1})]),n("div",no,[d(r,null,{title:i(()=>[y(" Vendite TOTALI ")]),content:i(()=>[o.dashboards.total?(u(),b("span",ro," € "+v((+o.dashboards.total).toFixed(2)||"-"),1)):(u(),b("span",lo," 0 "))]),_:1})])]),n("div",io,[n("div",co,[n("div",uo,[mo,d(s,{modelValue:o.form.course_name,"onUpdate:modelValue":e[2]||(e[2]=l=>o.form.course_name=l),options:o.dashboardCourses.courses,optionLabel:"name",optionValue:"name",placeholder:"",name:"location"},null,8,["modelValue","options"])]),d(a,{course:o.form.course_name},null,8,["course"])]),n("div",ho,[_o,d(t)])])])):x("",!0)])}const Co=B(E,[["render",bo]]);export{Co as default};
